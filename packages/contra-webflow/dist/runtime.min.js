"use strict";var ContraWebflow=(()=>{var E=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var A=(l,t)=>{for(var e in t)E(l,e,{get:t[e],enumerable:!0})},S=(l,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of L(t))!T.call(l,s)&&s!==e&&E(l,s,{get:()=>t[s],enumerable:!(i=$(t,s))||i.enumerable});return l};var R=l=>S(E({},"__esModule",{value:!0}),l);var M={};A(M,{ContraWebflowRuntime:()=>g,default:()=>g});var b=class f{constructor(t){this.cache=new Map,this.pendingRequests=new Map,this.config={baseUrl:"https://contra.com",timeout:1e4,debug:!1,...t},this.config.debug&&console.log("[ContraClient] Initialized with config:",this.config)}async fetch(t,e={},i=3){let s=`${this.config.baseUrl}${t}`,a=new AbortController,r=setTimeout(()=>a.abort(),this.config.timeout),o={...e,signal:a.signal,headers:{Accept:"application/json","X-API-key":this.config.apiKey,...e.headers}};try{this.config.debug&&console.log(`[ContraClient] Fetching: ${s}`,o);let n=await fetch(s,o);if(clearTimeout(r),!n.ok){let h;try{h=await n.json()}catch{h={code:`HTTP_${n.status}`,message:n.statusText||"Unknown error"}}if((n.status>=500||n.status===429)&&i>0){let m=Math.pow(2,3-i)*1e3;return await new Promise(w=>setTimeout(w,m)),this.fetch(t,e,i-1)}throw new u(h.message,h.code,n.status)}let p=await n.json();return this.config.debug&&console.log("[ContraClient] Response:",p),p}catch(n){if(clearTimeout(r),n instanceof u)throw n;if(n instanceof Error&&n.name==="AbortError")throw new u(`Request timeout after ${this.config.timeout}ms`,"TIMEOUT");if(i>0){let p=Math.pow(2,3-i)*1e3;return await new Promise(h=>setTimeout(h,p)),this.fetch(t,e,i-1)}throw new u(n instanceof Error?n.message:"Unknown error","NETWORK_ERROR")}}async fetchWithCache(t,e,i,s){let a=this.cache.get(t);if(a&&Date.now()-a.timestamp<a.ttl)return this.config.debug&&console.log(`[ContraClient] Cache hit: ${t}`),a.data;let r=`${e}${JSON.stringify(s)}`;if(this.pendingRequests.has(r))return this.config.debug&&console.log(`[ContraClient] Request deduplication: ${r}`),this.pendingRequests.get(r);let o=this.fetch(e,s);this.pendingRequests.set(r,o);try{let n=await o;return this.cache.set(t,{data:n,timestamp:Date.now(),ttl:i}),n}finally{this.pendingRequests.delete(r)}}buildQueryString(t){let e=new URLSearchParams;Object.entries(t).forEach(([s,a])=>{a!=null&&a!==""&&(Array.isArray(a)?e.set(s,a.join(",")):e.set(s,String(a)))});let i=e.toString();return i?`?${i}`:""}async getProgram(t){let e=`program:${t}`,i=`/public-api/programs/${t}`;return(await this.fetchWithCache(e,i,f.CACHE_TTL.program)).data}async listExperts(t,e={}){let i=this.buildQueryString(e),s=`experts:${t}:${JSON.stringify(e)}`,a=`/public-api/programs/${t}/experts${i}`;return this.fetchWithCache(s,a,f.CACHE_TTL.experts)}async searchExperts(t,e,i={}){let s=await this.listExperts(t,i);if(e.trim()){let a=e.toLowerCase();s.data=s.data.filter(r=>r.name&&r.name.toLowerCase().includes(a)||r.oneLiner&&r.oneLiner.toLowerCase().includes(a)||r.skillTags&&r.skillTags.some(o=>o&&o.toLowerCase().includes(a)))}return s}async getFilterOptions(t){let e=`filters:${t}`,i=`/public-api/programs/${t}/filters`;return this.fetchWithCache(e,i,f.CACHE_TTL.filters)}clearCache(t){if(t)for(let e of this.cache.keys())e.includes(t)&&this.cache.delete(e);else this.cache.clear();this.config.debug&&console.log(`[ContraClient] Cache cleared${t?` (pattern: ${t})`:""}`)}getCacheStats(){let t=Date.now(),e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,age:t-s.timestamp,ttl:s.ttl}));return{size:this.cache.size,entries:e}}};b.CACHE_TTL={experts:5*60*1e3,expert:10*60*1e3,program:30*60*1e3,filters:60*60*1e3};var C=b,u=class extends Error{constructor(l,t,e){super(l),this.code=t,this.status=e,this.name="ContraAPIError"}},y={formatRate(l){return l?`$${l}/hr`:"Rate on request"},renderStars(l){let t=Math.floor(l),e=l%1>=.5,i=5-t-(e?1:0),s="";for(let a=0;a<t;a++)s+=`<svg class="star star-full" width="16" height="16" viewBox="0 0 24 24" fill="#FFD700">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;e&&(s+=`<svg class="star star-half" width="16" height="16" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-${l}">
            <stop offset="50%" stop-color="#FFD700"/>
            <stop offset="50%" stop-color="#E5E5E5"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-${l})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`);for(let a=0;a<i;a++)s+=`<svg class="star star-empty" width="16" height="16" viewBox="0 0 24 24" fill="#E5E5E5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;return s},debounce(l,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>l(...i),t)}},throttle(l,t){let e;return(...i)=>{e||(l(...i),e=!0,setTimeout(()=>e=!1,t))}}};var d="data-contra-",c={program:"program",template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",filter:"filter",filterType:"filter-type",available:"available",sort:"sort",page:"page",limit:"limit",showWhen:"show-when",hideWhen:"hide-when",action:"action",target:"target"},v=class{constructor(){this.states=new Map}getState(t){return this.states.has(t)||this.states.set(t,{filters:{},experts:[],loading:!1,error:null,currentPage:1,totalCount:0}),this.states.get(t)}updateState(t,e){let i=this.getState(t);Object.assign(i,e),this.states.set(t,i)}},g=class{constructor(t){this.state=new v;this.debouncedReload=new Map;this.config={debug:!1,loadingClass:"loading",errorClass:"error",emptyClass:"empty",autoReload:!0,debounceDelay:300,maxRetries:3,videoAutoplay:!1,videoHoverPlay:!0,videoMuted:!0,videoLoop:!0,videoControls:!1,...t},this.client=new C({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config)}async init(){this.log("Initializing runtime...");try{let t=this.findExpertContainers();this.log(`Found ${t.length} expert containers`);for(let e of t)await this.initContainer(e);this.log("Runtime initialization complete")}catch(t){throw this.log("Runtime initialization failed",t),t}}async initContainer(t){let e=this.getAttr(t,c.program);if(!e){this.log("Container missing program ID",t);return}this.log(`Initializing container for program: ${e}`);try{this.setupContainer(t,e),this.wireFilterControls(t,e),this.wireActionButtons(t,e),await this.loadExperts(t,e)}catch(i){this.log(`Failed to initialize container for program ${e}`,i),this.showError(t,i)}}setupContainer(t,e){let i=t;i.classList.add("contra-runtime"),i.setAttribute("data-program-id",e);let s=this.parseFiltersFromElement(t);this.state.updateState(e,{filters:s});let a=y.debounce(()=>{this.loadExperts(t,e)},this.config.debounceDelay);this.debouncedReload.set(e,a),this.log(`Container setup complete for program: ${e}`,s)}wireFilterControls(t,e){let i=this.querySelectorAll(t,`[${d}${c.filter}]`);this.log(`Found ${i.length} filter controls for program: ${e}`),i.forEach(s=>{let a=this.getAttr(s,c.filter),r=this.getAttr(s,c.filterType)||"replace";if(a){if(s instanceof HTMLInputElement){let o=s.type==="range"||s.type==="number"?"input":"change";s.addEventListener(o,()=>{this.updateFilter(e,a,this.getControlValue(s),r),this.config.autoReload&&this.debouncedReload.get(e)?.()})}else s instanceof HTMLSelectElement&&s.addEventListener("change",()=>{this.updateFilter(e,a,this.getControlValue(s),r),this.config.autoReload&&this.debouncedReload.get(e)?.()});this.log(`Wired filter control: ${a} (${r})`,s)}})}wireActionButtons(t,e){this.querySelectorAll(t,`[${d}${c.action}]`).forEach(s=>{let a=this.getAttr(s,c.action),r=this.getAttr(s,c.target);a&&s.addEventListener("click",o=>{o.preventDefault(),this.handleAction(e,a,r,s)})})}async loadExperts(t,e){let i=this.state.getState(e);this.log(`Loading experts for program: ${e}`,i.filters);try{this.showLoading(t,!0),this.state.updateState(e,{loading:!0,error:null});let s=await this.client.listExperts(e,i.filters);this.log(`Loaded ${s.data.length} experts`,s),this.state.updateState(e,{experts:s.data,totalCount:s.totalCount,loading:!1}),this.renderExperts(t,s.data),this.updateUIStates(t,e),this.dispatchEvent(t,"expertsLoaded",{experts:s.data,totalCount:s.totalCount,filters:i.filters})}catch(s){this.log(`Failed to load experts for program: ${e}`,s),this.state.updateState(e,{loading:!1,error:s}),this.showError(t,s),this.dispatchEvent(t,"expertsError",{error:s,context:`Loading experts for program ${e}`})}finally{this.showLoading(t,!1)}}renderExperts(t,e){let i=this.querySelector(t,`[${d}${c.template}]`);if(!i){this.log("No template found in container",t);return}this.querySelectorAll(t,":scope > *:not([data-contra-template]):not([data-contra-loading]):not([data-contra-error]):not([data-contra-empty])").forEach(a=>a.remove()),e.forEach(a=>{let r=this.populateExpertCard(i,a);t.appendChild(r)}),this.log(`Rendered ${e.length} expert cards`)}populateExpertCard(t,e){let i=t.cloneNode(!0);return i.removeAttribute(`${d}${c.template}`),i.style.display="",this.populateFields(i,e),this.populateRepeatingElements(i,e),this.handleConditionalDisplay(i,e),i}populateFields(t,e){this.querySelectorAll(t,`[${d}${c.field}]`).forEach(a=>{let r=this.getAttr(a,c.field),o=this.getAttr(a,c.format);if(!r||!(r in e))return;let n=e[r];this.setElementValue(a,n,o)}),this.querySelectorAll(t,"[data-contra-stars]").forEach(a=>{e.averageReviewScore&&this.renderStarRating(a,e.averageReviewScore)})}setElementValue(t,e,i){if(!(e==null||e==="")){if(this.isMediaField(t)&&typeof e=="string"&&e.trim()){this.setMediaValue(t,e);return}if(t instanceof HTMLAnchorElement)t.href=String(e),t.textContent?.trim()||(t.textContent=String(e));else if(t instanceof HTMLInputElement)t.value=String(e);else if(t instanceof HTMLImageElement)t.src=String(e),t.alt=t.alt||"Image";else{let s=String(e);if(i)switch(i){case"currency":s=typeof e=="number"?`$${e}`:s;break;case"rate":s=y.formatRate(typeof e=="number"?e:null);break;case"rating":s=typeof e=="number"?e.toFixed(1):s;break;case"earnings":typeof e=="number"&&(e>=1e6?s=`$${Math.floor(e/1e6)}M+`:e>=1e3?s=`$${Math.floor(e/1e3)}k+`:s=`$${e}`);break;case"number":s=typeof e=="number"?e.toLocaleString():s;break;case"truncate":s=s.length>100?s.substring(0,97)+"...":s;break;case"boolean":s=e?"Yes":"No";break;case"availability":s=e?"Available":"Not Available";break}t.textContent=s}}}renderStarRating(t,e){let i=Math.floor(e),s=e%1>=.5,a=5-i-(s?1:0),r="";for(let n=0;n<i;n++)r+='<span class="contra-star contra-star-full">\u2605</span>';s&&(r+='<span class="contra-star contra-star-half">\u2605</span>');for(let n=0;n<a;n++)r+='<span class="contra-star contra-star-empty">\u2606</span>';t.innerHTML=r;let o=t.closest("[data-contra-template]")||t.closest(".expert-card");o&&this.querySelectorAll(o,"[data-contra-rating-text]").forEach(p=>{p.textContent=e.toFixed(1)})}isMediaField(t){return this.getAttr(t,c.field)==="coverUrl"}setMediaValue(t,e){let i=this.detectMediaType(e),s=t.parentElement;if(!s){this.log("Media element has no parent for replacement",t);return}t.remove();let a;switch(i){case"video":a=this.createVideoElement(e,t);break;case"image":default:a=this.createImageElement(e,t);break}this.transferAttributes(t,a),s.appendChild(a),this.log(`Created ${i} element for URL: ${e}`)}detectMediaType(t){if(!t||typeof t!="string")return this.log("Invalid URL provided to detectMediaType:",t),"image";let e=t.toLowerCase(),s=[".mp4",".webm",".mov",".avi",".mkv",".ogg"].some(r=>e.includes(r)),a=e.includes("cloudinary.com/")&&e.includes("/video/");return s||a?"video":"image"}createVideoElement(t,e){let i=document.createElement("video");return i.src=t,i.muted=this.config.videoMuted,i.loop=this.config.videoLoop,i.playsInline=!0,i.preload="metadata",i.controls=this.config.videoControls,i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",this.config.videoAutoplay&&(i.autoplay=!0,i.setAttribute("autoplay","")),i.onerror=()=>{this.log(`Video failed to load: ${t}`);let s=this.extractVideoThumbnail(t);if(s){let a=this.createImageElement(s,e);i.parentElement?.replaceChild(a,i)}else i.style.background="#f3f4f6",i.style.position="relative",i.innerHTML='<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#9ca3af;font-size:12px;">Video unavailable</div>'},this.config.videoHoverPlay&&!this.config.videoAutoplay&&(i.addEventListener("mouseenter",()=>{i.currentTime=0,i.play().catch(()=>{})}),i.addEventListener("mouseleave",()=>{i.pause(),i.currentTime=0})),i}createImageElement(t,e){let i=document.createElement("img");return i.src=t,i.alt=e.getAttribute("alt")||"Media content",i.loading="lazy",i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",i.onerror=()=>{this.log(`Image failed to load: ${t}`),i.style.background="#f3f4f6",i.style.opacity="0.5",i.alt="Image unavailable",i.style.position="relative";let s=document.createElement("div");s.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #9ca3af;
        font-size: 12px;
        text-align: center;
      `,s.textContent="\u{1F5BC}\uFE0F Image unavailable",i.parentElement?.appendChild(s)},i}extractVideoThumbnail(t){return t.includes("cloudinary.com/")&&t.includes("/video/")?t.replace("/video/","/image/").replace(/\.(mp4|webm|mov|avi|mkv)$/i,".jpg").replace("fl_progressive","f_auto,q_auto,c_fill"):null}transferAttributes(t,e){if(t.className&&(e.className=t.className),Array.from(t.attributes).forEach(i=>{i.name.startsWith("data-")&&i.name!==`${d}${c.field}`&&e.setAttribute(i.name,i.value)}),t.getAttribute("style")){let i=e.getAttribute("style")||"";e.setAttribute("style",i+"; "+t.getAttribute("style"))}}populateRepeatingElements(t,e){this.querySelectorAll(t,`[${d}${c.repeat}]`).forEach(s=>{let a=this.getAttr(s,c.repeat),r=parseInt(this.getAttr(s,c.max)||"10");a==="projects"&&e.projects?this.populateRepeatingContainer(s,e.projects.slice(0,r)):a==="socialLinks"&&e.socialLinks?this.populateRepeatingContainer(s,e.socialLinks.slice(0,r)):a==="skillTags"&&e.skillTags&&this.populateRepeatingContainer(s,e.skillTags.slice(0,r).map(o=>({name:o})))})}populateRepeatingContainer(t,e){let i=t.firstElementChild;i&&(t.innerHTML="",e.forEach(s=>{let a=i.cloneNode(!0);this.populateFields(a,s),t.appendChild(a)}),e.length===0&&(t.style.display="none"))}handleConditionalDisplay(t,e){this.querySelectorAll(t,`[${d}${c.showWhen}], [${d}${c.hideWhen}]`).forEach(s=>{let a=this.getAttr(s,c.showWhen),r=this.getAttr(s,c.hideWhen),o=!0;a&&(o=this.evaluateCondition(e,a)),r&&(o=o&&!this.evaluateCondition(e,r)),s.style.display=o?"":"none"})}evaluateCondition(t,e){if(!e||typeof e!="string")return this.log("Invalid condition provided:",e),!1;let[i,s,a]=e.split(":"),r=t[i];if(r==null)return!1;switch(s){case">":return Number(r)>Number(a);case"<":return Number(r)<Number(a);case">=":return Number(r)>=Number(a);case"<=":return Number(r)<=Number(a);default:let o=String(r),n=String(a||"");return o.toLowerCase()===n.toLowerCase()}}updateUIStates(t,e){let i=this.state.getState(e),s=this.querySelector(t,`[${d}${c.empty}]`);s&&(s.style.display=i.experts.length===0?"":"none"),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(o=>{let{currentPage:n,totalCount:p}=i,h=i.filters.limit||20,m=Math.ceil(p/h);o.textContent=`Page ${n} of ${m} (${p} total)`}),this.querySelectorAll(t,"[data-contra-filter-summary]").forEach(o=>{let n=Object.entries(i.filters).filter(([p,h])=>h!=null&&h!=="").map(([p,h])=>`${p}: ${h}`).join(", ");o.textContent=n||"No filters applied"})}getAttr(t,e){return t.getAttribute(`${d}${e}`)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return Array.from(t.querySelectorAll(e))}findExpertContainers(){return Array.from(document.querySelectorAll(`[${d}${c.program}]`))}parseFiltersFromElement(t){let e={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([s,a])=>{let r=this.getAttr(t,s);r!=null&&(a==="available"?e[a]=r==="true":a==="languages"?e[a]=r.split(",").map(o=>o.trim()):["minRate","maxRate","limit","offset"].includes(a)?e[a]=parseInt(r):e[a]=r)}),e}getControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":return t.checked;case"number":case"range":return t.valueAsNumber;default:return t.value}else if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;return null}updateFilter(t,e,i,s="replace"){let r={...this.state.getState(t).filters};if(s==="append"&&Array.isArray(r[e])){let n=r[e];r[e]=[...n,i]}else r[e]=i;this.state.updateState(t,{filters:r});let o={filters:r,element:document.querySelector(`[data-program-id="${t}"]`)};this.dispatchEvent(document,"filterChange",o)}handleAction(t,e,i,s){let a=this.state.getState(t);switch(e){case"next-page":this.updateFilter(t,"offset",(a.filters.offset||0)+(a.filters.limit||20));break;case"prev-page":this.updateFilter(t,"offset",Math.max(0,(a.filters.offset||0)-(a.filters.limit||20)));break;case"clear-filters":this.state.updateState(t,{filters:{}});break;case"reload":this.client.clearCache(`experts:${t}`);break}this.config.autoReload&&this.debouncedReload.get(t)?.()}showLoading(t,e){let i=this.querySelector(t,`[${d}${c.loading}]`);i&&(i.style.display=e?"":"none"),t.classList.toggle(this.config.loadingClass,e)}showError(t,e){let i=this.querySelector(t,`[${d}${c.error}]`);i&&(i.textContent=e.message,i.style.display=""),t.classList.add(this.config.errorClass),this.log("Error displayed",e)}dispatchEvent(t,e,i){let s=new CustomEvent(`contra:${e}`,{detail:i});t.dispatchEvent(s)}log(t,...e){this.config.debug&&console.log(`[ContraWebflow] ${t}`,...e)}};function x(){let l=document.getElementById("contra-config");if(!l){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let t=JSON.parse(l.textContent||"{}"),e=new g(t);window.contraRuntime=e,e.init().catch(i=>{console.error("[ContraWebflow] Runtime initialization failed:",i)})}catch(t){console.error("[ContraWebflow] Failed to parse config:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x();return R(M);})();
//# sourceMappingURL=runtime.min.js.map
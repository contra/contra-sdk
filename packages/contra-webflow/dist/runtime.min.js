"use strict";var ContraWebflow=(()=>{var y=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var T=(n,t)=>{for(var e in t)y(n,e,{get:t[e],enumerable:!0})},A=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of S(t))!L.call(n,i)&&i!==e&&y(n,i,{get:()=>t[i],enumerable:!(s=x(t,i))||s.enumerable});return n};var R=n=>A(y({},"__esModule",{value:!0}),n);var F={};T(F,{ContraWebflowRuntime:()=>m,default:()=>m});var v=class f{constructor(t){this.cache=new Map,this.pendingRequests=new Map,this.config={baseUrl:"https://api.contra.com",timeout:1e4,debug:!1,...t},this.config.debug&&console.log("[ContraClient] Initialized with config:",this.config)}async fetch(t,e={},s=3){let i=`${this.config.baseUrl}${t}`,r=new AbortController,a=setTimeout(()=>r.abort(),this.config.timeout),o={...e,signal:r.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,...e.headers}};try{this.config.debug&&console.log(`[ContraClient] Fetching: ${i}`,o);let l=await fetch(i,o);if(clearTimeout(a),!l.ok){let h;try{h=await l.json()}catch{h={code:`HTTP_${l.status}`,message:l.statusText||"Unknown error"}}if((l.status>=500||l.status===429)&&s>0){let E=Math.pow(2,3-s)*1e3;return await new Promise($=>setTimeout($,E)),this.fetch(t,e,s-1)}throw new g(h.message,h.code,l.status)}let p=await l.json();return this.config.debug&&console.log("[ContraClient] Response:",p),p}catch(l){if(clearTimeout(a),l instanceof g)throw l;if(l instanceof Error&&l.name==="AbortError")throw new g(`Request timeout after ${this.config.timeout}ms`,"TIMEOUT");if(s>0){let p=Math.pow(2,3-s)*1e3;return await new Promise(h=>setTimeout(h,p)),this.fetch(t,e,s-1)}throw new g(l instanceof Error?l.message:"Unknown error","NETWORK_ERROR")}}async fetchWithCache(t,e,s,i){let r=this.cache.get(t);if(r&&Date.now()-r.timestamp<r.ttl)return this.config.debug&&console.log(`[ContraClient] Cache hit: ${t}`),r.data;let a=`${e}${JSON.stringify(i)}`;if(this.pendingRequests.has(a))return this.config.debug&&console.log(`[ContraClient] Request deduplication: ${a}`),this.pendingRequests.get(a);let o=this.fetch(e,i);this.pendingRequests.set(a,o);try{let l=await o;return this.cache.set(t,{data:l,timestamp:Date.now(),ttl:s}),l}finally{this.pendingRequests.delete(a)}}buildQueryString(t){let e=new URLSearchParams;Object.entries(t).forEach(([i,r])=>{r!=null&&r!==""&&(Array.isArray(r)?e.set(i,r.join(",")):e.set(i,String(r)))});let s=e.toString();return s?`?${s}`:""}async getProgram(t){let e=`program:${t}`,s=`/public-api/programs/${t}`;return(await this.fetchWithCache(e,s,f.CACHE_TTL.program)).data}async listExperts(t,e={}){let s=this.buildQueryString(e),i=`experts:${t}:${JSON.stringify(e)}`,r=`/public-api/programs/${t}/experts${s}`;return this.fetchWithCache(i,r,f.CACHE_TTL.experts)}async getExpert(t){let e=`expert:${t}`,s=`/public-api/experts/${t}`;return(await this.fetchWithCache(e,s,f.CACHE_TTL.expert)).data}async searchExperts(t,e,s={}){let i={...s,q:e};return this.listExperts(t,i)}async getFilterOptions(t){let e=`filters:${t}`,s=`/public-api/programs/${t}/filters`;return(await this.fetchWithCache(e,s,f.CACHE_TTL.filters)).data}clearCache(t){if(t)for(let e of this.cache.keys())e.includes(t)&&this.cache.delete(e);else this.cache.clear();this.config.debug&&console.log(`[ContraClient] Cache cleared${t?` (pattern: ${t})`:""}`)}getCacheStats(){let t=Date.now(),e=Array.from(this.cache.entries()).map(([s,i])=>({key:s,age:t-i.timestamp,ttl:i.ttl}));return{size:this.cache.size,entries:e}}};v.CACHE_TTL={experts:5*60*1e3,expert:10*60*1e3,program:30*60*1e3,filters:60*60*1e3};var b=v,g=class extends Error{constructor(n,t,e){super(n),this.code=t,this.status=e,this.name="ContraAPIError"}},d={formatRate(n){return n?`$${n}/hr`:"Rate on request"},renderStars(n){let t=Math.floor(n),e=n%1>=.5,s=5-t-(e?1:0),i="";for(let r=0;r<t;r++)i+=`<svg class="star star-full" width="16" height="16" viewBox="0 0 24 24" fill="#FFD700">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;e&&(i+=`<svg class="star star-half" width="16" height="16" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-${n}">
            <stop offset="50%" stop-color="#FFD700"/>
            <stop offset="50%" stop-color="#E5E5E5"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-${n})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`);for(let r=0;r<s;r++)i+=`<svg class="star star-empty" width="16" height="16" viewBox="0 0 24 24" fill="#E5E5E5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;return i},debounce(n,t){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>n(...s),t)}},throttle(n,t){let e;return(...s)=>{e||(n(...s),e=!0,setTimeout(()=>e=!1,t))}}};var u="data-contra-",c={program:"program",template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",filter:"filter",filterType:"filter-type",sort:"sort",page:"page",limit:"limit",showWhen:"show-when",hideWhen:"hide-when",action:"action",target:"target"},C=class{constructor(){this.states=new Map}getState(t){return this.states.has(t)||this.states.set(t,{filters:{},experts:[],loading:!1,error:null,currentPage:1,totalCount:0}),this.states.get(t)}updateState(t,e){let s=this.getState(t);Object.assign(s,e),this.states.set(t,s)}},m=class{constructor(t){this.state=new C;this.debouncedReload=new Map;this.config={debug:!1,loadingClass:"loading",errorClass:"error",emptyClass:"empty",autoReload:!0,debounceDelay:300,maxRetries:3,...t},this.client=new b({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config)}async init(){this.log("Initializing runtime...");try{let t=this.findExpertContainers();this.log(`Found ${t.length} expert containers`);for(let e of t)await this.initContainer(e);this.log("Runtime initialization complete")}catch(t){throw this.log("Runtime initialization failed",t),t}}async initContainer(t){let e=this.getAttr(t,c.program);if(!e){this.log("Container missing program ID",t);return}this.log(`Initializing container for program: ${e}`);try{this.setupContainer(t,e),this.wireFilterControls(t,e),this.wireActionButtons(t,e),await this.loadExperts(t,e)}catch(s){this.log(`Failed to initialize container for program ${e}`,s),this.showError(t,s)}}setupContainer(t,e){let s=t;s.classList.add("contra-runtime"),s.setAttribute("data-program-id",e);let i=this.parseFiltersFromElement(t);this.state.updateState(e,{filters:i});let r=d.debounce(()=>{this.loadExperts(t,e)},this.config.debounceDelay);this.debouncedReload.set(e,r),this.log(`Container setup complete for program: ${e}`,i)}wireFilterControls(t,e){let s=this.querySelectorAll(t,`[${u}${c.filter}]`);this.log(`Found ${s.length} filter controls for program: ${e}`),s.forEach(i=>{let r=this.getAttr(i,c.filter),a=this.getAttr(i,c.filterType)||"replace";if(r){if(i instanceof HTMLInputElement){let o=i.type==="range"||i.type==="number"?"input":"change";i.addEventListener(o,()=>{this.updateFilter(e,r,this.getControlValue(i),a),this.config.autoReload&&this.debouncedReload.get(e)?.()})}else i instanceof HTMLSelectElement&&i.addEventListener("change",()=>{this.updateFilter(e,r,this.getControlValue(i),a),this.config.autoReload&&this.debouncedReload.get(e)?.()});this.log(`Wired filter control: ${r} (${a})`,i)}})}wireActionButtons(t,e){this.querySelectorAll(t,`[${u}${c.action}]`).forEach(i=>{let r=this.getAttr(i,c.action),a=this.getAttr(i,c.target);r&&i.addEventListener("click",o=>{o.preventDefault(),this.handleAction(e,r,a,i)})})}async loadExperts(t,e){let s=this.state.getState(e);this.log(`Loading experts for program: ${e}`,s.filters);try{this.showLoading(t,!0),this.state.updateState(e,{loading:!0,error:null});let i=await this.client.listExperts(e,s.filters);this.log(`Loaded ${i.data.length} experts`,i),this.state.updateState(e,{experts:i.data,totalCount:i.totalCount,loading:!1}),this.renderExperts(t,i.data),this.updateUIStates(t,e),this.dispatchEvent(t,"expertsLoaded",{experts:i.data,totalCount:i.totalCount,filters:s.filters})}catch(i){this.log(`Failed to load experts for program: ${e}`,i),this.state.updateState(e,{loading:!1,error:i}),this.showError(t,i),this.dispatchEvent(t,"expertsError",{error:i,context:`Loading experts for program ${e}`})}finally{this.showLoading(t,!1)}}renderExperts(t,e){let s=this.querySelector(t,`[${u}${c.template}]`);if(!s){this.log("No template found in container",t);return}this.querySelectorAll(t,":scope > *:not([data-contra-template]):not([data-contra-loading]):not([data-contra-error]):not([data-contra-empty])").forEach(r=>r.remove()),e.forEach(r=>{let a=this.populateExpertCard(s,r);t.appendChild(a)}),this.log(`Rendered ${e.length} expert cards`)}populateExpertCard(t,e){let s=t.cloneNode(!0);return s.removeAttribute(`${u}${c.template}`),s.style.display="",this.populateFields(s,e),this.populateRepeatingElements(s,e),this.handleConditionalDisplay(s,e),s}populateFields(t,e){this.querySelectorAll(t,`[${u}${c.field}]`).forEach(r=>{let a=this.getAttr(r,c.field),o=this.getAttr(r,c.format);if(!a||!(a in e))return;let l=e[a];this.setElementValue(r,l,o)}),this.querySelectorAll(t,"[data-contra-stars]").forEach(r=>{e.averageReviewScore&&(r.innerHTML=d.renderStars(e.averageReviewScore))})}setElementValue(t,e,s){if(e!=null)if(t instanceof HTMLImageElement)t.src=String(e),t.alt=t.alt||"Image";else if(t instanceof HTMLAnchorElement)t.href=String(e),t.textContent?.trim()||(t.textContent=String(e));else if(t instanceof HTMLInputElement)t.value=String(e);else{let i=String(e);if(s)switch(s){case"currency":i=typeof e=="number"?`$${e}`:i;break;case"rate":i=d.formatRate(typeof e=="number"?e:null);break;case"number":i=typeof e=="number"?e.toLocaleString():i;break;case"truncate":i=i.length>100?i.substring(0,97)+"...":i;break}t.textContent=i}}populateRepeatingElements(t,e){this.querySelectorAll(t,`[${u}${c.repeat}]`).forEach(i=>{let r=this.getAttr(i,c.repeat),a=parseInt(this.getAttr(i,c.max)||"10");r==="projects"&&e.projects?this.populateRepeatingContainer(i,e.projects.slice(0,a)):r==="socialLinks"&&e.socialLinks?this.populateRepeatingContainer(i,e.socialLinks.slice(0,a)):r==="skillTags"&&e.skillTags&&this.populateRepeatingContainer(i,e.skillTags.slice(0,a).map(o=>({name:o})))})}populateRepeatingContainer(t,e){let s=t.firstElementChild;s&&(t.innerHTML="",e.forEach(i=>{let r=s.cloneNode(!0);this.populateFields(r,i),t.appendChild(r)}),e.length===0&&(t.style.display="none"))}handleConditionalDisplay(t,e){this.querySelectorAll(t,`[${u}${c.showWhen}], [${u}${c.hideWhen}]`).forEach(i=>{let r=this.getAttr(i,c.showWhen),a=this.getAttr(i,c.hideWhen),o=!0;r&&(o=this.evaluateCondition(e,r)),a&&(o=o&&!this.evaluateCondition(e,a)),i.style.display=o?"":"none"})}evaluateCondition(t,e){let[s,i,r]=e.split(":"),a=t[s];if(a==null)return!1;switch(i){case">":return Number(a)>Number(r);case"<":return Number(a)<Number(r);case">=":return Number(a)>=Number(r);case"<=":return Number(a)<=Number(r);default:return String(a).toLowerCase()===r.toLowerCase()}}updateUIStates(t,e){let s=this.state.getState(e),i=this.querySelector(t,`[${u}${c.empty}]`);i&&(i.style.display=s.experts.length===0?"":"none"),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(o=>{let{currentPage:l,totalCount:p}=s,h=s.filters.limit||20,E=Math.ceil(p/h);o.textContent=`Page ${l} of ${E} (${p} total)`}),this.querySelectorAll(t,"[data-contra-filter-summary]").forEach(o=>{let l=Object.entries(s.filters).filter(([p,h])=>h!=null&&h!=="").map(([p,h])=>`${p}: ${h}`).join(", ");o.textContent=l||"No filters applied"})}getAttr(t,e){return t.getAttribute(`${u}${e}`)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return Array.from(t.querySelectorAll(e))}findExpertContainers(){return Array.from(document.querySelectorAll(`[${u}${c.program}]`))}parseFiltersFromElement(t){let e={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([i,r])=>{let a=this.getAttr(t,i);a!=null&&(r==="available"?e[r]=a==="true":r==="languages"?e[r]=a.split(",").map(o=>o.trim()):["minRate","maxRate","limit","offset"].includes(r)?e[r]=parseInt(a):e[r]=a)}),e}getControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":return t.checked;case"number":case"range":return t.valueAsNumber;default:return t.value}else if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;return null}updateFilter(t,e,s,i="replace"){let a={...this.state.getState(t).filters};if(i==="append"&&Array.isArray(a[e])){let l=a[e];a[e]=[...l,s]}else a[e]=s;this.state.updateState(t,{filters:a});let o={filters:a,element:document.querySelector(`[data-program-id="${t}"]`)};this.dispatchEvent(document,"filterChange",o)}handleAction(t,e,s,i){let r=this.state.getState(t);switch(e){case"next-page":this.updateFilter(t,"offset",(r.filters.offset||0)+(r.filters.limit||20));break;case"prev-page":this.updateFilter(t,"offset",Math.max(0,(r.filters.offset||0)-(r.filters.limit||20)));break;case"clear-filters":this.state.updateState(t,{filters:{}});break;case"reload":this.client.clearCache(`experts:${t}`);break}this.config.autoReload&&this.debouncedReload.get(t)?.()}showLoading(t,e){let s=this.querySelector(t,`[${u}${c.loading}]`);s&&(s.style.display=e?"":"none"),t.classList.toggle(this.config.loadingClass,e)}showError(t,e){let s=this.querySelector(t,`[${u}${c.error}]`);s&&(s.textContent=e.message,s.style.display=""),t.classList.add(this.config.errorClass),this.log("Error displayed",e)}dispatchEvent(t,e,s){let i=new CustomEvent(`contra:${e}`,{detail:s});t.dispatchEvent(i)}log(t,...e){this.config.debug&&console.log(`[ContraWebflow] ${t}`,...e)}};function w(){let n=document.getElementById("contra-config");if(!n){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let t=JSON.parse(n.textContent||"{}"),e=new m(t);window.contraRuntime=e,e.init().catch(s=>{console.error("[ContraWebflow] Runtime initialization failed:",s)})}catch(t){console.error("[ContraWebflow] Failed to parse config:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w();return R(F);})();
//# sourceMappingURL=runtime.min.js.map
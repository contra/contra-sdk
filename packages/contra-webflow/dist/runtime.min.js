"use strict";var ContraWebflow=(()=>{var y=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var A=(o,e)=>{for(var t in e)y(o,t,{get:e[t],enumerable:!0})},S=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of L(e))!T.call(o,s)&&s!==t&&y(o,s,{get:()=>e[s],enumerable:!(i=$(e,s))||i.enumerable});return o};var R=o=>S(y({},"__esModule",{value:!0}),o);var M={};A(M,{ContraWebflowRuntime:()=>m,default:()=>m});var C=class f{constructor(e){this.cache=new Map,this.pendingRequests=new Map,this.config={baseUrl:"https://contra.com",timeout:1e4,debug:!1,...e},this.config.debug&&console.log("[ContraClient] Initialized with config:",this.config)}async fetch(e,t={},i=3){let s=`${this.config.baseUrl}${e}`,a=new AbortController,r=setTimeout(()=>a.abort(),this.config.timeout),n={...t,signal:a.signal,headers:{Accept:"application/json","X-API-key":this.config.apiKey,...t.headers}};try{this.config.debug&&console.log(`[ContraClient] Fetching: ${s}`,n);let l=await fetch(s,n);if(clearTimeout(r),!l.ok){let h;try{h=await l.json()}catch{h={code:`HTTP_${l.status}`,message:l.statusText||"Unknown error"}}if((l.status>=500||l.status===429)&&i>0){let E=Math.pow(2,3-i)*1e3;return await new Promise(x=>setTimeout(x,E)),this.fetch(e,t,i-1)}throw new p(h.message,h.code,l.status)}let u=await l.json();return this.config.debug&&console.log("[ContraClient] Response:",u),u}catch(l){if(clearTimeout(r),l instanceof p)throw l;if(l instanceof Error&&l.name==="AbortError")throw new p(`Request timeout after ${this.config.timeout}ms`,"TIMEOUT");if(i>0){let u=Math.pow(2,3-i)*1e3;return await new Promise(h=>setTimeout(h,u)),this.fetch(e,t,i-1)}throw new p(l instanceof Error?l.message:"Unknown error","NETWORK_ERROR")}}async fetchWithCache(e,t,i,s){let a=this.cache.get(e);if(a&&Date.now()-a.timestamp<a.ttl)return this.config.debug&&console.log(`[ContraClient] Cache hit: ${e}`),a.data;let r=`${t}${JSON.stringify(s)}`;if(this.pendingRequests.has(r))return this.config.debug&&console.log(`[ContraClient] Request deduplication: ${r}`),this.pendingRequests.get(r);let n=this.fetch(t,s);this.pendingRequests.set(r,n);try{let l=await n;return this.cache.set(e,{data:l,timestamp:Date.now(),ttl:i}),l}finally{this.pendingRequests.delete(r)}}buildQueryString(e){let t=new URLSearchParams;Object.entries(e).forEach(([s,a])=>{a!=null&&a!==""&&(Array.isArray(a)?t.set(s,a.join(",")):t.set(s,String(a)))});let i=t.toString();return i?`?${i}`:""}async getProgram(e){let t=`program:${e}`,i=`/public-api/programs/${e}`;return(await this.fetchWithCache(t,i,f.CACHE_TTL.program)).data}async listExperts(e,t={}){let i=this.buildQueryString(t),s=`experts:${e}:${JSON.stringify(t)}`,a=`/public-api/programs/${e}/experts${i}`;return this.fetchWithCache(s,a,f.CACHE_TTL.experts)}async searchExperts(e,t,i={}){let s=await this.listExperts(e,i);if(t.trim()){let a=t.toLowerCase();s.data=s.data.filter(r=>r.name.toLowerCase().includes(a)||r.oneLiner.toLowerCase().includes(a)||r.skillTags.some(n=>n.toLowerCase().includes(a)))}return s}async getFilterOptions(e){let t=`filters:${e}`,i=`/public-api/programs/${e}/filters`;return this.fetchWithCache(t,i,f.CACHE_TTL.filters)}clearCache(e){if(e)for(let t of this.cache.keys())t.includes(e)&&this.cache.delete(t);else this.cache.clear();this.config.debug&&console.log(`[ContraClient] Cache cleared${e?` (pattern: ${e})`:""}`)}getCacheStats(){let e=Date.now(),t=Array.from(this.cache.entries()).map(([i,s])=>({key:i,age:e-s.timestamp,ttl:s.ttl}));return{size:this.cache.size,entries:t}}};C.CACHE_TTL={experts:5*60*1e3,expert:10*60*1e3,program:30*60*1e3,filters:60*60*1e3};var b=C,p=class extends Error{constructor(o,e,t){super(o),this.code=e,this.status=t,this.name="ContraAPIError"}},g={formatRate(o){return o?`$${o}/hr`:"Rate on request"},renderStars(o){let e=Math.floor(o),t=o%1>=.5,i=5-e-(t?1:0),s="";for(let a=0;a<e;a++)s+=`<svg class="star star-full" width="16" height="16" viewBox="0 0 24 24" fill="#FFD700">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;t&&(s+=`<svg class="star star-half" width="16" height="16" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-${o}">
            <stop offset="50%" stop-color="#FFD700"/>
            <stop offset="50%" stop-color="#E5E5E5"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-${o})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`);for(let a=0;a<i;a++)s+=`<svg class="star star-empty" width="16" height="16" viewBox="0 0 24 24" fill="#E5E5E5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;return s},debounce(o,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>o(...i),e)}},throttle(o,e){let t;return(...i)=>{t||(o(...i),t=!0,setTimeout(()=>t=!1,e))}}};var d="data-contra-",c={program:"program",template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",filter:"filter",filterType:"filter-type",sort:"sort",page:"page",limit:"limit",showWhen:"show-when",hideWhen:"hide-when",action:"action",target:"target"},v=class{constructor(){this.states=new Map}getState(e){return this.states.has(e)||this.states.set(e,{filters:{},experts:[],loading:!1,error:null,currentPage:1,totalCount:0}),this.states.get(e)}updateState(e,t){let i=this.getState(e);Object.assign(i,t),this.states.set(e,i)}},m=class{constructor(e){this.state=new v;this.debouncedReload=new Map;this.config={debug:!1,loadingClass:"loading",errorClass:"error",emptyClass:"empty",autoReload:!0,debounceDelay:300,maxRetries:3,...e},this.client=new b({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config)}async init(){this.log("Initializing runtime...");try{let e=this.findExpertContainers();this.log(`Found ${e.length} expert containers`);for(let t of e)await this.initContainer(t);this.log("Runtime initialization complete")}catch(e){throw this.log("Runtime initialization failed",e),e}}async initContainer(e){let t=this.getAttr(e,c.program);if(!t){this.log("Container missing program ID",e);return}this.log(`Initializing container for program: ${t}`);try{this.setupContainer(e,t),this.wireFilterControls(e,t),this.wireActionButtons(e,t),await this.loadExperts(e,t)}catch(i){this.log(`Failed to initialize container for program ${t}`,i),this.showError(e,i)}}setupContainer(e,t){let i=e;i.classList.add("contra-runtime"),i.setAttribute("data-program-id",t);let s=this.parseFiltersFromElement(e);this.state.updateState(t,{filters:s});let a=g.debounce(()=>{this.loadExperts(e,t)},this.config.debounceDelay);this.debouncedReload.set(t,a),this.log(`Container setup complete for program: ${t}`,s)}wireFilterControls(e,t){let i=this.querySelectorAll(e,`[${d}${c.filter}]`);this.log(`Found ${i.length} filter controls for program: ${t}`),i.forEach(s=>{let a=this.getAttr(s,c.filter),r=this.getAttr(s,c.filterType)||"replace";if(a){if(s instanceof HTMLInputElement){let n=s.type==="range"||s.type==="number"?"input":"change";s.addEventListener(n,()=>{this.updateFilter(t,a,this.getControlValue(s),r),this.config.autoReload&&this.debouncedReload.get(t)?.()})}else s instanceof HTMLSelectElement&&s.addEventListener("change",()=>{this.updateFilter(t,a,this.getControlValue(s),r),this.config.autoReload&&this.debouncedReload.get(t)?.()});this.log(`Wired filter control: ${a} (${r})`,s)}})}wireActionButtons(e,t){this.querySelectorAll(e,`[${d}${c.action}]`).forEach(s=>{let a=this.getAttr(s,c.action),r=this.getAttr(s,c.target);a&&s.addEventListener("click",n=>{n.preventDefault(),this.handleAction(t,a,r,s)})})}async loadExperts(e,t){let i=this.state.getState(t);this.log(`Loading experts for program: ${t}`,i.filters);try{this.showLoading(e,!0),this.state.updateState(t,{loading:!0,error:null});let s=await this.client.listExperts(t,i.filters);this.log(`Loaded ${s.data.length} experts`,s),this.state.updateState(t,{experts:s.data,totalCount:s.totalCount,loading:!1}),this.renderExperts(e,s.data),this.updateUIStates(e,t),this.dispatchEvent(e,"expertsLoaded",{experts:s.data,totalCount:s.totalCount,filters:i.filters})}catch(s){this.log(`Failed to load experts for program: ${t}`,s),this.state.updateState(t,{loading:!1,error:s}),this.showError(e,s),this.dispatchEvent(e,"expertsError",{error:s,context:`Loading experts for program ${t}`})}finally{this.showLoading(e,!1)}}renderExperts(e,t){let i=this.querySelector(e,`[${d}${c.template}]`);if(!i){this.log("No template found in container",e);return}this.querySelectorAll(e,":scope > *:not([data-contra-template]):not([data-contra-loading]):not([data-contra-error]):not([data-contra-empty])").forEach(a=>a.remove()),t.forEach(a=>{let r=this.populateExpertCard(i,a);e.appendChild(r)}),this.log(`Rendered ${t.length} expert cards`)}populateExpertCard(e,t){let i=e.cloneNode(!0);return i.removeAttribute(`${d}${c.template}`),i.style.display="",this.populateFields(i,t),this.populateRepeatingElements(i,t),this.handleConditionalDisplay(i,t),i}populateFields(e,t){this.querySelectorAll(e,`[${d}${c.field}]`).forEach(a=>{let r=this.getAttr(a,c.field),n=this.getAttr(a,c.format);if(!r||!(r in t))return;let l=t[r];this.setElementValue(a,l,n)}),this.querySelectorAll(e,"[data-contra-stars]").forEach(a=>{t.averageReviewScore&&(a.innerHTML=g.renderStars(t.averageReviewScore))})}setElementValue(e,t,i){if(t!=null){if(this.isMediaField(e)&&typeof t=="string"){this.setMediaValue(e,t);return}if(e instanceof HTMLAnchorElement)e.href=String(t),e.textContent?.trim()||(e.textContent=String(t));else if(e instanceof HTMLInputElement)e.value=String(t);else if(e instanceof HTMLImageElement)e.src=String(t),e.alt=e.alt||"Image";else{let s=String(t);if(i)switch(i){case"currency":s=typeof t=="number"?`$${t}`:s;break;case"rate":s=g.formatRate(typeof t=="number"?t:null);break;case"number":s=typeof t=="number"?t.toLocaleString():s;break;case"truncate":s=s.length>100?s.substring(0,97)+"...":s;break}e.textContent=s}}}isMediaField(e){return this.getAttr(e,c.field)==="coverUrl"}setMediaValue(e,t){let i=this.detectMediaType(t),s=e.parentElement;if(!s){this.log("Media element has no parent for replacement",e);return}e.remove();let a;switch(i){case"video":a=this.createVideoElement(t,e);break;case"image":default:a=this.createImageElement(t,e);break}this.transferAttributes(e,a),s.appendChild(a),this.log(`Created ${i} element for URL: ${t}`)}detectMediaType(e){let t=e.toLowerCase(),s=[".mp4",".webm",".mov",".avi",".mkv",".ogg"].some(r=>t.includes(r)),a=t.includes("cloudinary.com/")&&t.includes("/video/");return s||a?"video":"image"}createVideoElement(e,t){let i=document.createElement("video");return i.src=e,i.muted=!0,i.loop=!0,i.playsInline=!0,i.preload="metadata",i.controls=!1,i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",i.onerror=()=>{this.log(`Video failed to load: ${e}`);let s=this.extractVideoThumbnail(e);if(s){let a=this.createImageElement(s,t);i.parentElement?.replaceChild(a,i)}else i.style.background="#f3f4f6",i.style.position="relative",i.innerHTML='<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#9ca3af;font-size:12px;">Video unavailable</div>'},i.addEventListener("mouseenter",()=>{i.currentTime=0,i.play().catch(()=>{})}),i.addEventListener("mouseleave",()=>{i.pause(),i.currentTime=0}),i}createImageElement(e,t){let i=document.createElement("img");return i.src=e,i.alt=t.getAttribute("alt")||"Media content",i.loading="lazy",i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",i.onerror=()=>{this.log(`Image failed to load: ${e}`),i.style.background="#f3f4f6",i.style.opacity="0.5",i.alt="Image unavailable",i.style.position="relative";let s=document.createElement("div");s.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #9ca3af;
        font-size: 12px;
        text-align: center;
      `,s.textContent="\u{1F5BC}\uFE0F Image unavailable",i.parentElement?.appendChild(s)},i}extractVideoThumbnail(e){return e.includes("cloudinary.com/")&&e.includes("/video/")?e.replace("/video/","/image/").replace(/\.(mp4|webm|mov|avi|mkv)$/i,".jpg").replace("fl_progressive","f_auto,q_auto,c_fill"):null}transferAttributes(e,t){if(e.className&&(t.className=e.className),Array.from(e.attributes).forEach(i=>{i.name.startsWith("data-")&&i.name!==`${d}${c.field}`&&t.setAttribute(i.name,i.value)}),e.getAttribute("style")){let i=t.getAttribute("style")||"";t.setAttribute("style",i+"; "+e.getAttribute("style"))}}populateRepeatingElements(e,t){this.querySelectorAll(e,`[${d}${c.repeat}]`).forEach(s=>{let a=this.getAttr(s,c.repeat),r=parseInt(this.getAttr(s,c.max)||"10");a==="projects"&&t.projects?this.populateRepeatingContainer(s,t.projects.slice(0,r)):a==="socialLinks"&&t.socialLinks?this.populateRepeatingContainer(s,t.socialLinks.slice(0,r)):a==="skillTags"&&t.skillTags&&this.populateRepeatingContainer(s,t.skillTags.slice(0,r).map(n=>({name:n})))})}populateRepeatingContainer(e,t){let i=e.firstElementChild;i&&(e.innerHTML="",t.forEach(s=>{let a=i.cloneNode(!0);this.populateFields(a,s),e.appendChild(a)}),t.length===0&&(e.style.display="none"))}handleConditionalDisplay(e,t){this.querySelectorAll(e,`[${d}${c.showWhen}], [${d}${c.hideWhen}]`).forEach(s=>{let a=this.getAttr(s,c.showWhen),r=this.getAttr(s,c.hideWhen),n=!0;a&&(n=this.evaluateCondition(t,a)),r&&(n=n&&!this.evaluateCondition(t,r)),s.style.display=n?"":"none"})}evaluateCondition(e,t){let[i,s,a]=t.split(":"),r=e[i];if(r==null)return!1;switch(s){case">":return Number(r)>Number(a);case"<":return Number(r)<Number(a);case">=":return Number(r)>=Number(a);case"<=":return Number(r)<=Number(a);default:return String(r).toLowerCase()===a.toLowerCase()}}updateUIStates(e,t){let i=this.state.getState(t),s=this.querySelector(e,`[${d}${c.empty}]`);s&&(s.style.display=i.experts.length===0?"":"none"),this.querySelectorAll(e,"[data-contra-pagination-info]").forEach(n=>{let{currentPage:l,totalCount:u}=i,h=i.filters.limit||20,E=Math.ceil(u/h);n.textContent=`Page ${l} of ${E} (${u} total)`}),this.querySelectorAll(e,"[data-contra-filter-summary]").forEach(n=>{let l=Object.entries(i.filters).filter(([u,h])=>h!=null&&h!=="").map(([u,h])=>`${u}: ${h}`).join(", ");n.textContent=l||"No filters applied"})}getAttr(e,t){return e.getAttribute(`${d}${t}`)}querySelector(e,t){return e.querySelector(t)}querySelectorAll(e,t){return Array.from(e.querySelectorAll(t))}findExpertContainers(){return Array.from(document.querySelectorAll(`[${d}${c.program}]`))}parseFiltersFromElement(e){let t={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([s,a])=>{let r=this.getAttr(e,s);r!=null&&(a==="available"?t[a]=r==="true":a==="languages"?t[a]=r.split(",").map(n=>n.trim()):["minRate","maxRate","limit","offset"].includes(a)?t[a]=parseInt(r):t[a]=r)}),t}getControlValue(e){if(e instanceof HTMLInputElement)switch(e.type){case"checkbox":return e.checked;case"number":case"range":return e.valueAsNumber;default:return e.value}else if(e instanceof HTMLSelectElement)return e.multiple?Array.from(e.selectedOptions).map(t=>t.value):e.value;return null}updateFilter(e,t,i,s="replace"){let r={...this.state.getState(e).filters};if(s==="append"&&Array.isArray(r[t])){let l=r[t];r[t]=[...l,i]}else r[t]=i;this.state.updateState(e,{filters:r});let n={filters:r,element:document.querySelector(`[data-program-id="${e}"]`)};this.dispatchEvent(document,"filterChange",n)}handleAction(e,t,i,s){let a=this.state.getState(e);switch(t){case"next-page":this.updateFilter(e,"offset",(a.filters.offset||0)+(a.filters.limit||20));break;case"prev-page":this.updateFilter(e,"offset",Math.max(0,(a.filters.offset||0)-(a.filters.limit||20)));break;case"clear-filters":this.state.updateState(e,{filters:{}});break;case"reload":this.client.clearCache(`experts:${e}`);break}this.config.autoReload&&this.debouncedReload.get(e)?.()}showLoading(e,t){let i=this.querySelector(e,`[${d}${c.loading}]`);i&&(i.style.display=t?"":"none"),e.classList.toggle(this.config.loadingClass,t)}showError(e,t){let i=this.querySelector(e,`[${d}${c.error}]`);i&&(i.textContent=t.message,i.style.display=""),e.classList.add(this.config.errorClass),this.log("Error displayed",t)}dispatchEvent(e,t,i){let s=new CustomEvent(`contra:${t}`,{detail:i});e.dispatchEvent(s)}log(e,...t){this.config.debug&&console.log(`[ContraWebflow] ${e}`,...t)}};function w(){let o=document.getElementById("contra-config");if(!o){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let e=JSON.parse(o.textContent||"{}"),t=new m(e);window.contraRuntime=t,t.init().catch(i=>{console.error("[ContraWebflow] Runtime initialization failed:",i)})}catch(e){console.error("[ContraWebflow] Failed to parse config:",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w();return R(M);})();
//# sourceMappingURL=runtime.min.js.map
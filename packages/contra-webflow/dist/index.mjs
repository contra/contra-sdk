import {ContraClient,utils}from'@contra/client';var g="data-contra-",l={template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",filter:"filter",filterType:"filter-type",limit:"limit",paginationMode:"pagination-mode",showWhen:"show-when",hideWhen:"hide-when",action:"action",target:"target"},m=class{constructor(){this.states=new Map;}getState(t){return this.states.has(t)||this.states.set(t,{filters:{},experts:[],loading:false,error:null,currentPage:1,totalCount:0,cachedPages:new Map,loadingPages:new Set,hasNextPage:false,hasPreviousPage:false,isInfiniteLoading:false,lastScrollPosition:0,paginationMode:"traditional",programId:""}),this.states.get(t)}updateState(t,e){let a=this.getState(t);Object.assign(a,e),this.states.set(t,a);}cachePage(t,e,a){let i=this.getState(t);if(i.cachedPages.set(e,a),i.cachedPages.size>5){let s=Math.min(...i.cachedPages.keys());i.cachedPages.delete(s);}}getCachedPage(t,e){return this.getState(t).cachedPages.get(e)||null}setPageLoading(t,e,a){let i=this.getState(t);a?i.loadingPages.add(e):i.loadingPages.delete(e);}isPageLoading(t,e){return this.getState(t).loadingPages.has(e)}},f=class{constructor(t){this.state=new m;this.debouncedReload=new Map;this.config={debug:false,program:"",loadingClass:"loading",errorClass:"error",emptyClass:"empty",autoReload:true,debounceDelay:300,maxRetries:3,paginationMode:"traditional",infiniteScrollThreshold:500,preloadNextPage:true,maxCachedPages:5,smoothScrollBehavior:"auto",loadMoreText:"Load More",videoAutoplay:false,videoHoverPlay:true,videoMuted:true,videoLoop:true,videoControls:false,...t},this.client=new ContraClient({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config);}async init(){this.log("Initializing runtime...");try{let t=this.findExpertContainers(),e=t.filter(a=>!a.hasAttribute("data-contra-initialized"));this.log(`Found ${e.length} uninitialised expert containers (${t.length} total)`);for(let a of e)await this.initContainer(a);this.log("Runtime initialization complete");}catch(t){throw this.log("Runtime initialization failed",t),t}}async initContainer(t){let e=this.config.program;if(!e){this.log("No program ID found in config",t);return}let a=document.querySelectorAll("[data-contra-limit], [data-contra-pagination]"),s=`container-${Array.from(a).indexOf(t)}`;this.log(`Initializing container ${s} for program: ${e}`);try{this.setupContainer(t,s,e),this.wireFilterControls(t,s),this.wireActionButtons(t,s),this.setupDebouncedReload(s),await this.loadExperts(t,s);}catch(o){this.log(`Failed to initialize container ${s}`,o),this.showError(t,o);}}setupDebouncedReload(t){let e;this.debouncedReload.set(t,()=>{clearTimeout(e),e=setTimeout(()=>{let a=document.querySelector(`[data-container-id="${t}"]`);a&&this.loadExperts(a,t);},this.config.debounceDelay);});}setupContainer(t,e,a){let i=t;i.classList.add("contra-runtime"),i.setAttribute("data-contra-initialized","true"),i.setAttribute("data-container-id",e);let s=this.getAttr(t,"pagination")||"traditional",o=parseInt(this.getAttr(t,"limit")||"20");this.state.updateState(e,{filters:{limit:o,offset:0},paginationMode:s,experts:[],loading:false,error:null,currentPage:1,totalCount:0,hasNextPage:false,hasPreviousPage:false,cachedPages:new Map,loadingPages:new Set,isInfiniteLoading:false,lastScrollPosition:0,programId:a}),this.log(`Container ${e} setup complete:`,{paginationMode:s,limit:o});}wireFilterControls(t,e){let a=this.querySelectorAll(t,`[${g}${l.filter}]`);this.log(`Found ${a.length} filter controls for container: ${e}`),a.forEach(i=>{let s=this.getAttr(i,l.filter),o=this.getAttr(i,l.filterType)||"replace";if(s){if(i instanceof HTMLInputElement){let n=i.type==="range"||i.type==="number"?"input":"change";i.addEventListener(n,()=>{this.updateFilter(e,s,this.getControlValue(i),o),this.config.autoReload&&this.debouncedReload.get(e)?.();});}else i instanceof HTMLSelectElement&&i.addEventListener("change",()=>{this.updateFilter(e,s,this.getControlValue(i),o),this.config.autoReload&&this.debouncedReload.get(e)?.();});this.log(`Wired filter control: ${s} (${o})`,i);}});}wireActionButtons(t,e){this.querySelectorAll(t,`[${g}${l.action}]`).forEach(i=>{let s=this.getAttr(i,l.action),o=this.getAttr(i,l.target);s&&i.addEventListener("click",n=>{n.preventDefault(),this.handleAction(e,s,o,i);});});}async loadExperts(t,e,a=false){let i=this.state.getState(e),s=i.programId;this.log(`Loading experts for container: ${e}, program: ${s}`,i.filters);try{this.showLoading(t,!0),this.state.updateState(e,{loading:!0,error:null});let o=await this.client.listExperts(s,i.filters);this.log(`Loaded ${o.data.length} experts`,o),i.paginationMode==="traditional"?this.handleTraditionalPaginationResponse(e,t,o):this.handleInfinitePaginationResponse(e,t,o);}catch(o){this.log(`Failed to load experts for container: ${e}`,o),this.state.updateState(e,{loading:false,error:o}),this.showError(t,o),this.dispatchEvent(t,"expertsError",{error:o,context:`Loading experts for container ${e}`});}finally{this.showLoading(t,false);}}handleTraditionalPaginationResponse(t,e,a){let i=this.state.getState(t),s=i.filters.limit||20,o=i.filters.offset||0,n=Math.floor(o/s)+1,r=Math.ceil(a.totalCount/s),d=n<r,c=n>1;this.state.updateState(t,{experts:a.data,totalCount:a.totalCount,currentPage:n,hasNextPage:d,hasPreviousPage:c,loading:false}),this.state.cachePage(t,n,a.data),this.renderExperts(e,a.data),this.updateUIStates(e,t),this.updatePaginationControls(e,t),this.dispatchEvent(e,"expertsLoaded",{experts:a.data,totalCount:a.totalCount,filters:i.filters,page:n,totalPages:r,hasNextPage:d,hasPreviousPage:c,paginationMode:"traditional"}),this.log(`Traditional pagination: Page ${n}/${r}, ${a.data.length} experts loaded`);}handleInfinitePaginationResponse(t,e,a){let i=this.state.getState(t),s=i.experts.length>0,o=s?[...i.experts,...a.data]:a.data,n=o.length<a.totalCount;this.state.updateState(t,{experts:o,totalCount:a.totalCount,hasNextPage:n,hasPreviousPage:false,loading:false,isInfiniteLoading:false}),s?this.renderNewExperts(e,a.data):this.renderExperts(e,a.data),this.updateUIStates(e,t),this.updatePaginationControls(e,t),this.dispatchEvent(e,"expertsLoaded",{experts:a.data,totalExperts:o,totalCount:a.totalCount,filters:i.filters,hasNextPage:n,isLoadMore:s,paginationMode:"infinite"}),this.log(`Infinite pagination: ${o.length}/${a.totalCount} experts loaded`);}calculateCurrentPage(t){let e=t.limit||20,a=t.offset||0;return Math.floor(a/e)+1}updatePaginationState(t,e,a,i){let s=i.limit||20,o=i.offset||0,n=Math.floor(o/s)+1,r=Math.ceil(a/s);this.state.updateState(t,{experts:e,totalCount:a,currentPage:n,hasNextPage:n<r,hasPreviousPage:n>1,loading:false});}renderExperts(t,e){let a=this.querySelector(t,`[${g}${l.template}]`),i=t;if(!a){let o=this.querySelector(t,".expert-grid");o&&(a=this.querySelector(o,`[${g}${l.template}]`),i=o);}if(!a){this.log("No template found in container or expert-grid",t);return}this.querySelectorAll(i,".expert-card:not([data-contra-template])").forEach(o=>o.remove()),e.forEach(o=>{let n=this.populateExpertCard(a,o);i.appendChild(n);}),this.log(`Rendered ${e.length} expert cards in`,i);}populateExpertCard(t,e){let a=t.cloneNode(true);return a.removeAttribute(`${g}${l.template}`),a.style.display="",this.populateFields(a,e),this.populateRepeatingElements(a,e),this.handleConditionalDisplay(a,e),a}populateFields(t,e){this.querySelectorAll(t,`[${g}${l.field}]`).forEach(s=>{let o=this.getAttr(s,l.field),n=this.getAttr(s,l.format);if(!o||!(o in e))return;let r=e[o];this.setElementValue(s,r,n);}),this.querySelectorAll(t,"[data-contra-stars]").forEach(s=>{e.averageReviewScore&&this.renderStarRating(s,e.averageReviewScore);});}setElementValue(t,e,a){if(!(e==null||e==="")){if(this.isMediaField(t)&&typeof e=="string"&&e.trim()){this.setMediaValue(t,e);return}if(t instanceof HTMLAnchorElement)t.href=String(e),t.textContent?.trim()||(t.textContent=String(e));else if(t instanceof HTMLInputElement)t.value=String(e);else if(t instanceof HTMLImageElement)t.src=String(e),t.alt=t.alt||"Image";else {let i=String(e);if(a)switch(a){case "currency":i=typeof e=="number"?`$${e}`:i;break;case "rate":i=utils.formatRate(typeof e=="number"?e:null);break;case "rating":i=typeof e=="number"?e.toFixed(1):i;break;case "earnings":typeof e=="number"&&(e>=1e6?i=`$${Math.floor(e/1e6)}M+`:e>=1e3?i=`$${Math.floor(e/1e3)}k+`:i=`$${e}`);break;case "number":i=typeof e=="number"?e.toLocaleString():i;break;case "truncate":i=i.length>100?i.substring(0,97)+"...":i;break;case "boolean":i=e?"Yes":"No";break;case "availability":i=e?"Available":"Not Available";break}t.textContent=i;}}}renderStarRating(t,e){let a=Math.floor(e),i=e%1>=.5,s=5-a-(i?1:0),o="";for(let r=0;r<a;r++)o+='<span class="contra-star contra-star-full">\u2605</span>';i&&(o+='<span class="contra-star contra-star-half">\u2605</span>');for(let r=0;r<s;r++)o+='<span class="contra-star contra-star-empty">\u2606</span>';t.innerHTML=o;let n=t.closest("[data-contra-template]")||t.closest(".expert-card");n&&this.querySelectorAll(n,"[data-contra-rating-text]").forEach(d=>{d.textContent=e.toFixed(1);});}isMediaField(t){return this.getAttr(t,l.field)==="coverUrl"}setMediaValue(t,e){let a=this.detectMediaType(e),i=t.parentElement;if(!i){this.log("Media element has no parent for replacement",t);return}t.remove();let s;switch(a){case "video":s=this.createVideoElement(e,t);break;case "image":default:s=this.createImageElement(e,t);break}this.transferAttributes(t,s),i.appendChild(s),this.log(`Created ${a} element for URL: ${e}`);}detectMediaType(t){if(!t||typeof t!="string")return this.log("Invalid URL provided to detectMediaType:",t),"image";let e=t.toLowerCase(),i=[".mp4",".webm",".mov",".avi",".mkv",".ogg"].some(o=>e.includes(o)),s=e.includes("cloudinary.com/")&&e.includes("/video/");return i||s?"video":"image"}createVideoElement(t,e){let a=document.createElement("video");return a.src=t,a.muted=this.config.videoMuted,a.loop=this.config.videoLoop,a.playsInline=true,a.preload="metadata",a.controls=this.config.videoControls,a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.style.borderRadius="inherit",this.config.videoAutoplay&&(a.autoplay=true,a.setAttribute("autoplay","")),a.onerror=()=>{this.log(`Video failed to load: ${t}`);let i=this.extractVideoThumbnail(t);if(i){let s=this.createImageElement(i,e);a.parentElement?.replaceChild(s,a);}else a.style.background="#f3f4f6",a.style.position="relative",a.innerHTML='<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#9ca3af;font-size:12px;">Video unavailable</div>';},this.config.videoHoverPlay&&!this.config.videoAutoplay&&(a.addEventListener("mouseenter",()=>{a.currentTime=0,a.play().catch(()=>{});}),a.addEventListener("mouseleave",()=>{a.pause(),a.currentTime=0;})),a}createImageElement(t,e){let a=document.createElement("img");return a.src=t,a.alt=e.getAttribute("alt")||"Media content",a.loading="lazy",a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.style.borderRadius="inherit",a.onerror=()=>{this.log(`Image failed to load: ${t}`),a.style.background="#f3f4f6",a.style.opacity="0.5",a.alt="Image unavailable",a.style.position="relative";let i=document.createElement("div");i.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #9ca3af;
        font-size: 12px;
        text-align: center;
      `,i.textContent="\u{1F5BC}\uFE0F Image unavailable",a.parentElement?.appendChild(i);},a}extractVideoThumbnail(t){return t.includes("cloudinary.com/")&&t.includes("/video/")?t.replace("/video/","/image/").replace(/\.(mp4|webm|mov|avi|mkv)$/i,".jpg").replace("fl_progressive","f_auto,q_auto,c_fill"):null}transferAttributes(t,e){if(t.className&&(e.className=t.className),Array.from(t.attributes).forEach(a=>{a.name.startsWith("data-")&&a.name!==`${g}${l.field}`&&e.setAttribute(a.name,a.value);}),t.getAttribute("style")){let a=e.getAttribute("style")||"";e.setAttribute("style",a+"; "+t.getAttribute("style"));}}populateRepeatingElements(t,e){this.querySelectorAll(t,`[${g}${l.repeat}]`).forEach(i=>{let s=this.getAttr(i,l.repeat),o=parseInt(this.getAttr(i,l.max)||"10");s==="projects"&&e.projects?this.populateRepeatingContainer(i,e.projects.slice(0,o)):s==="socialLinks"&&e.socialLinks?this.populateRepeatingContainer(i,e.socialLinks.slice(0,o)):s==="skillTags"&&e.skillTags&&this.populateRepeatingContainer(i,e.skillTags.slice(0,o).map(n=>({name:n})));});}populateRepeatingContainer(t,e){let a=t.firstElementChild;a&&(t.innerHTML="",e.forEach(i=>{let s=a.cloneNode(true);this.populateFields(s,i),t.appendChild(s);}),e.length===0&&(t.style.display="none"));}handleConditionalDisplay(t,e){this.querySelectorAll(t,`[${g}${l.showWhen}], [${g}${l.hideWhen}]`).forEach(i=>{let s=this.getAttr(i,l.showWhen),o=this.getAttr(i,l.hideWhen),n=true;s&&(n=this.evaluateCondition(e,s)),o&&(n=n&&!this.evaluateCondition(e,o)),i.style.display=n?"":"none";});}evaluateCondition(t,e){if(!e||typeof e!="string")return this.log("Invalid condition provided:",e),false;let a=e.split(":"),i=a[0],s=t[i];if(a.length===1){if(s==null)return  false;if(Array.isArray(s)){let r=s.length>0;return this.log(`Existence check on array '${i}': length is ${s.length}, result: ${r}`),r}let n=!!s;return this.log(`Existence check on field '${i}': value is ${s}, result: ${n}`),n}if(s==null)return this.log(`Field '${i}' is null/undefined, condition fails`),false;let o=a.slice(1).join(":");if(this.log(`Evaluating condition: ${i} (${s}, type: ${typeof s}) against ${o}`),o.startsWith(">=")){let n=o.substring(2),r=Number(s)>=Number(n);return this.log(`Comparison: ${s} >= ${n} = ${r}`),r}else if(o.startsWith("<=")){let n=o.substring(2),r=Number(s)<=Number(n);return this.log(`Comparison: ${s} <= ${n} = ${r}`),r}else if(o.startsWith(">")){let n=o.substring(1),r=Number(s)>Number(n);return this.log(`Comparison: ${s} > ${n} = ${r}`),r}else if(o.startsWith("<")){let n=o.substring(1),r=Number(s)<Number(n);return this.log(`Comparison: ${s} < ${n} = ${r}`),r}else {let n=false;if(typeof s=="boolean")o.toLowerCase()==="true"?n=s===true:o.toLowerCase()==="false"?n=s===false:n=false,this.log(`Boolean comparison: ${s} === ${o.toLowerCase()==="true"} = ${n}`);else if(typeof s=="number"){let r=Number(o);n=!isNaN(r)&&s===r,this.log(`Number comparison: ${s} === ${r} = ${n}`);}else {let r=String(s),d=String(o);n=r.toLowerCase()===d.toLowerCase(),this.log(`String comparison: '${r}' === '${d}' = ${n}`);}return n}}updateUIStates(t,e){let a=this.state.getState(e),i=this.querySelector(t,`[${g}${l.empty}]`);i&&(i.style.display=a.experts.length===0?"":"none"),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(n=>{let{currentPage:r,totalCount:d}=a,c=a.filters.limit||20,p=Math.ceil(d/c);n.textContent=`Page ${r} of ${p} (${d} total)`;}),this.querySelectorAll(t,"[data-contra-filter-summary]").forEach(n=>{let r=Object.entries(a.filters).filter(([d,c])=>c!=null&&c!=="").map(([d,c])=>`${d}: ${c}`).join(", ");n.textContent=r||"No filters applied";});}handleAction(t,e,a,i){let s=this.state.getState(t),o=document.querySelector(`[data-container-id="${t}"]`);if(!o){this.log(`Container not found: ${t}`);return}i&&i instanceof HTMLButtonElement&&(i.disabled=true);let n=s.filters.limit||20,r=s.filters.offset||0;switch(e){case "next-page":if(s.paginationMode==="traditional"){let d=r+n;d<s.totalCount&&(this.updateFilter(t,"offset",d),this.loadExperts(o,t,true));}else this.loadMoreExperts(o,t);break;case "prev-page":if(s.paginationMode==="traditional"){let d=Math.max(0,r-n);this.updateFilter(t,"offset",d),this.loadExperts(o,t,true);}break;case "first-page":s.paginationMode==="traditional"&&(this.updateFilter(t,"offset",0),this.loadExperts(o,t,true));break;case "last-page":if(s.paginationMode==="traditional"){let c=(Math.ceil(s.totalCount/n)-1)*n;this.updateFilter(t,"offset",c),this.loadExperts(o,t,true);}break;case "load-more":this.loadMoreExperts(o,t).finally(()=>{i&&i instanceof HTMLButtonElement&&(i.disabled=false);});return;case "reload":this.state.updateState(t,{cachedPages:new Map}),this.loadExperts(o,t);break}i&&i instanceof HTMLButtonElement&&e!=="load-more"&&setTimeout(()=>{i.disabled=false;},100);}async loadMoreExperts(t,e){let a=this.state.getState(e);if(a.paginationMode==="traditional"){this.log("Load more not supported in traditional pagination mode");return}let i=a.filters.limit||20,s=a.experts.length;this.log(`Loading more experts: currentOffset=${s}, limit=${i}`);try{this.state.updateState(e,{isInfiniteLoading:!0}),this.updateLoadMoreButtonState(t,e,!0);let o=await this.client.listExperts(e,{...a.filters,offset:s,limit:i});this.log(`Loaded ${o.data.length} more experts from offset ${s}`),this.handleInfinitePaginationResponse(e,t,o);}catch(o){this.log("Failed to load more experts",o),this.state.updateState(e,{isInfiniteLoading:false}),this.updateLoadMoreButtonState(t,e,false,"Error loading more"),setTimeout(()=>{this.updateLoadMoreButtonState(t,e,false);},3e3);}finally{this.updateLoadMoreButtonState(t,e,false);}}updateLoadMoreButtonState(t,e,a,i){let s=this.querySelectorAll(t,'[data-contra-action="load-more"]'),o=this.state.getState(e);s.forEach(n=>{let r=n;if(i){r.textContent=i,r.disabled=true,r.classList.add("error");return}r.classList.remove("error"),a?(r.textContent="Loading...",r.disabled=true,r.classList.add("loading")):(r.classList.remove("loading"),o.experts.length<o.totalCount?(r.textContent=this.config.loadMoreText,r.disabled=false):(r.textContent="All experts loaded",r.disabled=true,r.classList.add("disabled")));});}async loadNextPageInfinite(t,e){return this.loadMoreExperts(t,e)}updatePaginationControls(t,e){let a=this.state.getState(e),i=a.filters.limit||20,s=Math.ceil(a.totalCount/i);a.paginationMode==="traditional"?this.updateTraditionalPaginationControls(t,a,s):this.updateInfinitePaginationControls(t,a),this.log(`Pagination controls updated: mode=${a.paginationMode}, page=${a.currentPage}/${s}, hasNext=${a.hasNextPage}`);}updateTraditionalPaginationControls(t,e,a){let i=this.querySelectorAll(t,'[data-contra-action="prev-page"]'),s=this.querySelectorAll(t,'[data-contra-action="next-page"]'),o=this.querySelectorAll(t,'[data-contra-action="first-page"]'),n=this.querySelectorAll(t,'[data-contra-action="last-page"]');i.forEach(c=>{let p=c;p.disabled=!e.hasPreviousPage,p.classList.toggle("disabled",!e.hasPreviousPage);}),s.forEach(c=>{let p=c;p.disabled=!e.hasNextPage,p.classList.toggle("disabled",!e.hasNextPage);}),o.forEach(c=>{let p=c;p.disabled=e.currentPage<=1,p.classList.toggle("disabled",e.currentPage<=1);}),n.forEach(c=>{let p=c;p.disabled=e.currentPage>=a,p.classList.toggle("disabled",e.currentPage>=a);}),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(c=>{c.textContent=`Page ${e.currentPage} of ${a} (${e.totalCount} total)`;});let d=t.querySelector(".pagination-section");d&&(d.style.display=a>1?"block":"none");}updateInfinitePaginationControls(t,e){this.updateLoadMoreButtonState(t,e.programId||"default",e.isInfiniteLoading),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(s=>{let o=e.experts.length,n=e.totalCount;s.textContent=`Showing ${o} of ${n} experts`;});let i=t.querySelector(".pagination-controls");i&&(i.style.display="none");}updateInfiniteLoadingState(t,e){this.querySelectorAll(t,"[data-contra-infinite-loading]").forEach(i=>{i.style.display=e?"":"none";});}renderNewExperts(t,e){let a=this.querySelector(t,`[${g}${l.template}]`),i=t;if(!a){let o=this.querySelector(t,".expert-grid");o&&(a=this.querySelector(o,`[${g}${l.template}]`),i=o);}if(!a){this.log("No template found for rendering new experts",t);return}let s=document.createDocumentFragment();e.forEach(o=>{let n=this.populateExpertCard(a,o);s.appendChild(n);}),i.appendChild(s),this.log(`Rendered ${e.length} new expert cards for load more`);}getAttr(t,e){return t.getAttribute(`${g}${e}`)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return Array.from(t.querySelectorAll(e))}findExpertContainers(){this.log("Looking for expert containers...");let t=`[${g}${l.limit}], [${g}${l.paginationMode}]`,e=Array.from(document.querySelectorAll(t));return this.log(`Found ${e.length} containers using selector: ${t}`,e),e}parseFiltersFromElement(t){let e={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([i,s])=>{let o=this.getAttr(t,i);o!=null&&(s==="available"?e[s]=o==="true":s==="languages"?e[s]=o.split(",").map(n=>n.trim()):["minRate","maxRate","limit","offset"].includes(s)?e[s]=parseInt(o):e[s]=o);}),e.offset===void 0&&(e.offset=0),e}getControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case "checkbox":return t.checked;case "number":case "range":return t.valueAsNumber;default:return t.value}else if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;return null}updateFilter(t,e,a,i="replace"){let o={...this.state.getState(t).filters},n=a;if(e==="available"?typeof a=="string"&&(a==="true"?n=true:a==="false"?n=false:(a===""||a===null)&&(n=void 0)):(e==="minRate"||e==="maxRate")&&(a===""||a===null?n=void 0:n=Number(a)),i==="append"&&Array.isArray(o[e])){let d=o[e];o[e]=[...d,n];}else o[e]=n;e!=="offset"&&(o.offset=0),this.state.updateState(t,{filters:o}),this.log(`Filter updated: ${e} = ${n} (original: ${a})`);let r={filters:o,element:document.querySelector(`[data-container-id="${t}"]`)};this.dispatchEvent(document,"filterChange",r);}showLoading(t,e){let a=this.querySelector(t,`[${g}${l.loading}]`);a&&(a.style.display=e?"":"none"),t.classList.toggle(this.config.loadingClass,e);}showError(t,e){let a=this.querySelector(t,`[${g}${l.error}]`);a&&(a.textContent=e.message,a.style.display=""),t.classList.add(this.config.errorClass),this.log("Error displayed",e);}dispatchEvent(t,e,a){let i=new CustomEvent(`contra:${e}`,{detail:a});t.dispatchEvent(i);}log(t,...e){this.config.debug&&console.log(`[ContraWebflow] ${t}`,...e);}};function h(){let u=document.getElementById("contra-config");if(!u){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let t=JSON.parse(u.textContent||"{}");if(!t.apiKey){console.error("[ContraWebflow] API key is required in config.");return}if(!t.program){console.error("[ContraWebflow] Program ID is required in config.");return}setTimeout(()=>{let a=new f(t);window.contraRuntime=a,a.init().catch(i=>{console.error("[ContraWebflow] Runtime initialization failed:",i);});},100);}catch(t){console.error("[ContraWebflow] Failed to parse config:",t);}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):document.readyState==="interactive"?setTimeout(h,50):h();export{f as ContraWebflowRuntime};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map
import {ContraClient,utils}from'@contra/client';var u="data-contra-",d={template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",filter:"filter",filterType:"filter-type",showWhen:"show-when",hideWhen:"hide-when",action:"action",target:"target"},E=class{constructor(){this.states=new Map;}getState(t){return this.states.has(t)||this.states.set(t,{filters:{},experts:[],loading:false,error:null,currentPage:1,totalCount:0,cachedPages:new Map,loadingPages:new Set,hasNextPage:false,hasPreviousPage:false,isInfiniteLoading:false,lastScrollPosition:0,paginationMode:"traditional"}),this.states.get(t)}updateState(t,e){let i=this.getState(t);Object.assign(i,e),this.states.set(t,i);}cachePage(t,e,i){let a=this.getState(t);if(a.cachedPages.set(e,i),a.cachedPages.size>5){let n=Math.min(...a.cachedPages.keys());a.cachedPages.delete(n);}}getCachedPage(t,e){return this.getState(t).cachedPages.get(e)||null}setPageLoading(t,e,i){let a=this.getState(t);i?a.loadingPages.add(e):a.loadingPages.delete(e);}isPageLoading(t,e){return this.getState(t).loadingPages.has(e)}},h=class{constructor(t){this.state=new E;this.debouncedReload=new Map;this.config={debug:false,program:"",loadingClass:"loading",errorClass:"error",emptyClass:"empty",autoReload:true,debounceDelay:300,maxRetries:3,paginationMode:"traditional",infiniteScrollThreshold:500,preloadNextPage:true,maxCachedPages:5,smoothScrollBehavior:"auto",loadMoreText:"Load More",videoAutoplay:false,videoHoverPlay:true,videoMuted:true,videoLoop:true,videoControls:false,...t},this.client=new ContraClient({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config);}async init(){this.log("Initializing runtime...");try{let t=this.findExpertContainers(),e=t.filter(i=>!i.hasAttribute("data-contra-initialized"));this.log(`Found ${e.length} uninitialised expert containers (${t.length} total)`);for(let i of e)await this.initContainer(i);this.log("Runtime initialization complete");}catch(t){throw this.log("Runtime initialization failed",t),t}}async initContainer(t){let e=this.config.program;if(!e){this.log("No program ID found in config",t);return}this.log(`Initializing container for program: ${e}`);try{this.setupContainer(t,e),this.wireFilterControls(t,e),this.wireActionButtons(t,e),await this.loadExperts(t,e);}catch(i){this.log(`Failed to initialize container for program ${e}`,i),this.showError(t,i);}}setupContainer(t,e){let i=t;i.classList.add("contra-runtime"),i.setAttribute("data-contra-initialized","true"),i.setAttribute("data-program-id",e);let a=this.parseFiltersFromElement(t),n=this.determinePaginationMode(t);this.state.updateState(e,{filters:a,paginationMode:n}),this.setupPagination(t,e,n);let o=utils.debounce(()=>{this.loadExperts(t,e);},this.config.debounceDelay);this.debouncedReload.set(e,o),this.log(`Container setup complete for program: ${e}`,{initialFilters:a,paginationMode:n});}determinePaginationMode(t){return this.getAttr(t,"pagination-mode")||this.config.paginationMode}setupPagination(t,e,i){this.log(`Setting up ${i} pagination for program: ${e}`),(i==="infinite"||i==="hybrid")&&this.setupInfiniteScroll(t,e),(i==="traditional"||i==="hybrid")&&this.setupTraditionalPagination(t,e),(i==="infinite"||i==="hybrid")&&this.setupLoadMoreButton(t,e);}setupInfiniteScroll(t,e){let i=false,a=utils.throttle(()=>{if(i)return;let n=this.state.getState(e);if(n.isInfiniteLoading||!n.hasNextPage)return;let o=window.scrollY+window.innerHeight,s=document.documentElement.scrollHeight,r=this.config.infiniteScrollThreshold;o>=s-r&&(i=true,this.loadNextPageInfinite(t,e).finally(()=>{i=false;}));},100);window.addEventListener("scroll",a),t.__infiniteScrollCleanup=()=>{window.removeEventListener("scroll",a);};}setupTraditionalPagination(t,e){this.updatePaginationControls(t,e);}setupLoadMoreButton(t,e){this.querySelectorAll(t,'[data-contra-action="load-more"]').forEach(a=>{a.textContent?.trim()||(a.textContent=this.config.loadMoreText);});}wireFilterControls(t,e){let i=this.querySelectorAll(t,`[${u}${d.filter}]`);this.log(`Found ${i.length} filter controls for program: ${e}`),i.forEach(a=>{let n=this.getAttr(a,d.filter),o=this.getAttr(a,d.filterType)||"replace";if(n){if(a instanceof HTMLInputElement){let s=a.type==="range"||a.type==="number"?"input":"change";a.addEventListener(s,()=>{this.updateFilter(e,n,this.getControlValue(a),o),this.config.autoReload&&this.debouncedReload.get(e)?.();});}else a instanceof HTMLSelectElement&&a.addEventListener("change",()=>{this.updateFilter(e,n,this.getControlValue(a),o),this.config.autoReload&&this.debouncedReload.get(e)?.();});this.log(`Wired filter control: ${n} (${o})`,a);}});}wireActionButtons(t,e){this.querySelectorAll(t,`[${u}${d.action}]`).forEach(a=>{let n=this.getAttr(a,d.action),o=this.getAttr(a,d.target);n&&a.addEventListener("click",s=>{s.preventDefault(),this.handleAction(e,n,o,a);});});}async loadExperts(t,e,i=false){let a=this.state.getState(e);this.log(`Loading experts for program: ${e}`,a.filters);try{if(this.showLoading(t,!0),this.state.updateState(e,{loading:!0,error:null}),i&&a.paginationMode==="traditional"){let o=this.calculateCurrentPage(a.filters),s=this.state.getCachedPage(e,o);if(s){this.log(`Using cached page ${o}`),this.renderExperts(t,s),this.updatePaginationState(e,s,a.totalCount,a.filters),this.showLoading(t,!1);return}}let n=await this.client.listExperts(e,a.filters);this.log(`Loaded ${n.data.length} experts`,n),a.paginationMode==="traditional"?this.handleTraditionalPaginationResponse(e,t,n):this.handleInfinitePaginationResponse(e,t,n);}catch(n){this.log(`Failed to load experts for program: ${e}`,n),this.state.updateState(e,{loading:false,error:n}),this.showError(t,n),this.dispatchEvent(t,"expertsError",{error:n,context:`Loading experts for program ${e}`});}finally{this.showLoading(t,false);}}handleTraditionalPaginationResponse(t,e,i){let a=this.state.getState(t),n=a.filters.limit||20,o=a.filters.offset||0,s=Math.floor(o/n)+1,r=Math.ceil(i.totalCount/n),l=s<r,c=s>1;this.state.updateState(t,{experts:i.data,totalCount:i.totalCount,currentPage:s,hasNextPage:l,hasPreviousPage:c,loading:false}),this.state.cachePage(t,s,i.data),this.renderExperts(e,i.data),this.updateUIStates(e,t),this.updatePaginationControls(e,t),this.dispatchEvent(e,"expertsLoaded",{experts:i.data,totalCount:i.totalCount,filters:a.filters,page:s,totalPages:r,hasNextPage:l,hasPreviousPage:c,paginationMode:"traditional"}),this.log(`Traditional pagination: Page ${s}/${r}, ${i.data.length} experts loaded`);}handleInfinitePaginationResponse(t,e,i){let a=this.state.getState(t),n=a.experts.length>0,o=n?[...a.experts,...i.data]:i.data,s=o.length<i.totalCount;this.state.updateState(t,{experts:o,totalCount:i.totalCount,hasNextPage:s,hasPreviousPage:false,loading:false,isInfiniteLoading:false}),n?this.renderNewExperts(e,i.data):this.renderExperts(e,i.data),this.updateUIStates(e,t),this.updatePaginationControls(e,t),this.dispatchEvent(e,"expertsLoaded",{experts:i.data,totalExperts:o,totalCount:i.totalCount,filters:a.filters,hasNextPage:s,isLoadMore:n,paginationMode:"infinite"}),this.log(`Infinite pagination: ${o.length}/${i.totalCount} experts loaded`);}calculateCurrentPage(t){let e=t.limit||20,i=t.offset||0;return Math.floor(i/e)+1}updatePaginationState(t,e,i,a){let n=a.limit||20,o=a.offset||0,s=Math.floor(o/n)+1,r=Math.ceil(i/n);this.state.updateState(t,{experts:e,totalCount:i,currentPage:s,hasNextPage:s<r,hasPreviousPage:s>1,loading:false});}renderExperts(t,e){let i=this.querySelector(t,`[${u}${d.template}]`);if(!i){this.log("No template found in container",t);return}this.querySelectorAll(t,":scope > *:not([data-contra-template]):not([data-contra-loading]):not([data-contra-error]):not([data-contra-empty])").forEach(n=>n.remove()),e.forEach(n=>{let o=this.populateExpertCard(i,n);t.appendChild(o);}),this.log(`Rendered ${e.length} expert cards`);}populateExpertCard(t,e){let i=t.cloneNode(true);return i.removeAttribute(`${u}${d.template}`),i.style.display="",this.populateFields(i,e),this.populateRepeatingElements(i,e),this.handleConditionalDisplay(i,e),i}populateFields(t,e){this.querySelectorAll(t,`[${u}${d.field}]`).forEach(n=>{let o=this.getAttr(n,d.field),s=this.getAttr(n,d.format);if(!o||!(o in e))return;let r=e[o];this.setElementValue(n,r,s);}),this.querySelectorAll(t,"[data-contra-stars]").forEach(n=>{e.averageReviewScore&&this.renderStarRating(n,e.averageReviewScore);});}setElementValue(t,e,i){if(!(e==null||e==="")){if(this.isMediaField(t)&&typeof e=="string"&&e.trim()){this.setMediaValue(t,e);return}if(t instanceof HTMLAnchorElement)t.href=String(e),t.textContent?.trim()||(t.textContent=String(e));else if(t instanceof HTMLInputElement)t.value=String(e);else if(t instanceof HTMLImageElement)t.src=String(e),t.alt=t.alt||"Image";else {let a=String(e);if(i)switch(i){case "currency":a=typeof e=="number"?`$${e}`:a;break;case "rate":a=utils.formatRate(typeof e=="number"?e:null);break;case "rating":a=typeof e=="number"?e.toFixed(1):a;break;case "earnings":typeof e=="number"&&(e>=1e6?a=`$${Math.floor(e/1e6)}M+`:e>=1e3?a=`$${Math.floor(e/1e3)}k+`:a=`$${e}`);break;case "number":a=typeof e=="number"?e.toLocaleString():a;break;case "truncate":a=a.length>100?a.substring(0,97)+"...":a;break;case "boolean":a=e?"Yes":"No";break;case "availability":a=e?"Available":"Not Available";break}t.textContent=a;}}}renderStarRating(t,e){let i=Math.floor(e),a=e%1>=.5,n=5-i-(a?1:0),o="";for(let r=0;r<i;r++)o+='<span class="contra-star contra-star-full">\u2605</span>';a&&(o+='<span class="contra-star contra-star-half">\u2605</span>');for(let r=0;r<n;r++)o+='<span class="contra-star contra-star-empty">\u2606</span>';t.innerHTML=o;let s=t.closest("[data-contra-template]")||t.closest(".expert-card");s&&this.querySelectorAll(s,"[data-contra-rating-text]").forEach(l=>{l.textContent=e.toFixed(1);});}isMediaField(t){return this.getAttr(t,d.field)==="coverUrl"}setMediaValue(t,e){let i=this.detectMediaType(e),a=t.parentElement;if(!a){this.log("Media element has no parent for replacement",t);return}t.remove();let n;switch(i){case "video":n=this.createVideoElement(e,t);break;case "image":default:n=this.createImageElement(e,t);break}this.transferAttributes(t,n),a.appendChild(n),this.log(`Created ${i} element for URL: ${e}`);}detectMediaType(t){if(!t||typeof t!="string")return this.log("Invalid URL provided to detectMediaType:",t),"image";let e=t.toLowerCase(),a=[".mp4",".webm",".mov",".avi",".mkv",".ogg"].some(o=>e.includes(o)),n=e.includes("cloudinary.com/")&&e.includes("/video/");return a||n?"video":"image"}createVideoElement(t,e){let i=document.createElement("video");return i.src=t,i.muted=this.config.videoMuted,i.loop=this.config.videoLoop,i.playsInline=true,i.preload="metadata",i.controls=this.config.videoControls,i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",this.config.videoAutoplay&&(i.autoplay=true,i.setAttribute("autoplay","")),i.onerror=()=>{this.log(`Video failed to load: ${t}`);let a=this.extractVideoThumbnail(t);if(a){let n=this.createImageElement(a,e);i.parentElement?.replaceChild(n,i);}else i.style.background="#f3f4f6",i.style.position="relative",i.innerHTML='<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#9ca3af;font-size:12px;">Video unavailable</div>';},this.config.videoHoverPlay&&!this.config.videoAutoplay&&(i.addEventListener("mouseenter",()=>{i.currentTime=0,i.play().catch(()=>{});}),i.addEventListener("mouseleave",()=>{i.pause(),i.currentTime=0;})),i}createImageElement(t,e){let i=document.createElement("img");return i.src=t,i.alt=e.getAttribute("alt")||"Media content",i.loading="lazy",i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",i.onerror=()=>{this.log(`Image failed to load: ${t}`),i.style.background="#f3f4f6",i.style.opacity="0.5",i.alt="Image unavailable",i.style.position="relative";let a=document.createElement("div");a.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #9ca3af;
        font-size: 12px;
        text-align: center;
      `,a.textContent="\u{1F5BC}\uFE0F Image unavailable",i.parentElement?.appendChild(a);},i}extractVideoThumbnail(t){return t.includes("cloudinary.com/")&&t.includes("/video/")?t.replace("/video/","/image/").replace(/\.(mp4|webm|mov|avi|mkv)$/i,".jpg").replace("fl_progressive","f_auto,q_auto,c_fill"):null}transferAttributes(t,e){if(t.className&&(e.className=t.className),Array.from(t.attributes).forEach(i=>{i.name.startsWith("data-")&&i.name!==`${u}${d.field}`&&e.setAttribute(i.name,i.value);}),t.getAttribute("style")){let i=e.getAttribute("style")||"";e.setAttribute("style",i+"; "+t.getAttribute("style"));}}populateRepeatingElements(t,e){this.querySelectorAll(t,`[${u}${d.repeat}]`).forEach(a=>{let n=this.getAttr(a,d.repeat),o=parseInt(this.getAttr(a,d.max)||"10");n==="projects"&&e.projects?this.populateRepeatingContainer(a,e.projects.slice(0,o)):n==="socialLinks"&&e.socialLinks?this.populateRepeatingContainer(a,e.socialLinks.slice(0,o)):n==="skillTags"&&e.skillTags&&this.populateRepeatingContainer(a,e.skillTags.slice(0,o).map(s=>({name:s})));});}populateRepeatingContainer(t,e){let i=t.firstElementChild;i&&(t.innerHTML="",e.forEach(a=>{let n=i.cloneNode(true);this.populateFields(n,a),t.appendChild(n);}),e.length===0&&(t.style.display="none"));}handleConditionalDisplay(t,e){this.querySelectorAll(t,`[${u}${d.showWhen}], [${u}${d.hideWhen}]`).forEach(a=>{let n=this.getAttr(a,d.showWhen),o=this.getAttr(a,d.hideWhen),s=true;n&&(s=this.evaluateCondition(e,n)),o&&(s=s&&!this.evaluateCondition(e,o)),a.style.display=s?"":"none";});}evaluateCondition(t,e){if(!e||typeof e!="string")return this.log("Invalid condition provided:",e),false;let i=e.split(":");if(i.length<2)return this.log("Invalid condition format:",e),false;let a=i[0],n=i.slice(1).join(":"),o=t[a];if(this.log(`Evaluating condition: ${a} (${o}, type: ${typeof o}) against ${n}`),o==null)return this.log(`Field '${a}' is null/undefined, condition fails`),false;if(n.startsWith(">=")){let s=n.substring(2),r=Number(o)>=Number(s);return this.log(`Comparison: ${o} >= ${s} = ${r}`),r}else if(n.startsWith("<=")){let s=n.substring(2),r=Number(o)<=Number(s);return this.log(`Comparison: ${o} <= ${s} = ${r}`),r}else if(n.startsWith(">")){let s=n.substring(1),r=Number(o)>Number(s);return this.log(`Comparison: ${o} > ${s} = ${r}`),r}else if(n.startsWith("<")){let s=n.substring(1),r=Number(o)<Number(s);return this.log(`Comparison: ${o} < ${s} = ${r}`),r}else {let s=false;if(typeof o=="boolean")n.toLowerCase()==="true"?s=o===true:n.toLowerCase()==="false"?s=o===false:s=false,this.log(`Boolean comparison: ${o} === ${n.toLowerCase()==="true"} = ${s}`);else if(typeof o=="number"){let r=Number(n);s=!isNaN(r)&&o===r,this.log(`Number comparison: ${o} === ${r} = ${s}`);}else {let r=String(o),l=String(n);s=r.toLowerCase()===l.toLowerCase(),this.log(`String comparison: '${r}' === '${l}' = ${s}`);}return s}}updateUIStates(t,e){let i=this.state.getState(e),a=this.querySelector(t,`[${u}${d.empty}]`);a&&(a.style.display=i.experts.length===0?"":"none"),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(s=>{let{currentPage:r,totalCount:l}=i,c=i.filters.limit||20,g=Math.ceil(l/c);s.textContent=`Page ${r} of ${g} (${l} total)`;}),this.querySelectorAll(t,"[data-contra-filter-summary]").forEach(s=>{let r=Object.entries(i.filters).filter(([l,c])=>c!=null&&c!=="").map(([l,c])=>`${l}: ${c}`).join(", ");s.textContent=r||"No filters applied";});}handleAction(t,e,i,a){let n=this.state.getState(t),o=document.querySelector(`[data-program-id="${t}"]`);if(!o){this.log(`Container not found for program: ${t}`);return}a&&a instanceof HTMLButtonElement&&(a.disabled=true);let s=n.filters.limit||20,r=n.filters.offset||0;switch(e){case "next-page":if(n.paginationMode==="traditional"){let l=r+s;l<n.totalCount&&(this.updateFilter(t,"offset",l),this.loadExperts(o,t,true));}else this.loadMoreExperts(o,t);break;case "prev-page":if(n.paginationMode==="traditional"){let l=Math.max(0,r-s);this.updateFilter(t,"offset",l),this.loadExperts(o,t,true);}break;case "first-page":n.paginationMode==="traditional"&&(this.updateFilter(t,"offset",0),this.loadExperts(o,t,true));break;case "last-page":if(n.paginationMode==="traditional"){let c=(Math.ceil(n.totalCount/s)-1)*s;this.updateFilter(t,"offset",c),this.loadExperts(o,t,true);}break;case "load-more":this.loadMoreExperts(o,t).finally(()=>{a&&a instanceof HTMLButtonElement&&(a.disabled=false);});return;case "clear-filters":this.state.updateState(t,{filters:{limit:n.filters.limit,offset:0},currentPage:1,cachedPages:new Map}),this.config.autoReload&&this.debouncedReload.get(t)?.();break;case "reload":this.state.updateState(t,{cachedPages:new Map}),this.client.clearCache(`experts:${t}`),this.config.autoReload&&this.debouncedReload.get(t)?.();break}a&&a instanceof HTMLButtonElement&&e!=="load-more"&&setTimeout(()=>{a.disabled=false;},100);}async loadMoreExperts(t,e){let i=this.state.getState(e);if(i.paginationMode==="traditional"){this.log("Load more not supported in traditional pagination mode");return}let a=i.filters.limit||20,n=i.experts.length;this.log(`Loading more experts: currentOffset=${n}, limit=${a}`);try{this.state.updateState(e,{isInfiniteLoading:!0}),this.updateLoadMoreButtonState(t,e,!0);let o=await this.client.listExperts(e,{...i.filters,offset:n,limit:a});this.log(`Loaded ${o.data.length} more experts from offset ${n}`),this.handleInfinitePaginationResponse(e,t,o);}catch(o){this.log("Failed to load more experts",o),this.state.updateState(e,{isInfiniteLoading:false}),this.updateLoadMoreButtonState(t,e,false,"Error loading more"),setTimeout(()=>{this.updateLoadMoreButtonState(t,e,false);},3e3);}finally{this.updateLoadMoreButtonState(t,e,false);}}updateLoadMoreButtonState(t,e,i,a){let n=this.querySelectorAll(t,'[data-contra-action="load-more"]'),o=this.state.getState(e);n.forEach(s=>{let r=s;if(a){r.textContent=a,r.disabled=true,r.classList.add("error");return}r.classList.remove("error"),i?(r.textContent="Loading...",r.disabled=true,r.classList.add("loading")):(r.classList.remove("loading"),o.experts.length<o.totalCount?(r.textContent=this.config.loadMoreText,r.disabled=false):(r.textContent="All experts loaded",r.disabled=true,r.classList.add("disabled")));});}async loadNextPageInfinite(t,e){return this.loadMoreExperts(t,e)}updatePaginationControls(t,e){let i=this.state.getState(e),a=i.filters.limit||20,n=Math.ceil(i.totalCount/a);i.paginationMode==="traditional"?this.updateTraditionalPaginationControls(t,i,n):this.updateInfinitePaginationControls(t,i),this.log(`Pagination controls updated: mode=${i.paginationMode}, page=${i.currentPage}/${n}, hasNext=${i.hasNextPage}`);}updateTraditionalPaginationControls(t,e,i){let a=this.querySelectorAll(t,'[data-contra-action="prev-page"]'),n=this.querySelectorAll(t,'[data-contra-action="next-page"]'),o=this.querySelectorAll(t,'[data-contra-action="first-page"]'),s=this.querySelectorAll(t,'[data-contra-action="last-page"]');a.forEach(c=>{let g=c;g.disabled=!e.hasPreviousPage,g.classList.toggle("disabled",!e.hasPreviousPage);}),n.forEach(c=>{let g=c;g.disabled=!e.hasNextPage,g.classList.toggle("disabled",!e.hasNextPage);}),o.forEach(c=>{let g=c;g.disabled=e.currentPage<=1,g.classList.toggle("disabled",e.currentPage<=1);}),s.forEach(c=>{let g=c;g.disabled=e.currentPage>=i,g.classList.toggle("disabled",e.currentPage>=i);}),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(c=>{c.textContent=`Page ${e.currentPage} of ${i} (${e.totalCount} total)`;});let l=t.querySelector(".pagination-section");l&&(l.style.display=i>1?"block":"none");}updateInfinitePaginationControls(t,e){this.updateLoadMoreButtonState(t,e.programId||"default",e.isInfiniteLoading),this.querySelectorAll(t,"[data-contra-pagination-info]").forEach(n=>{let o=e.experts.length,s=e.totalCount;n.textContent=`Showing ${o} of ${s} experts`;});let a=t.querySelector(".pagination-controls");a&&(a.style.display="none");}updateInfiniteLoadingState(t,e){this.querySelectorAll(t,"[data-contra-infinite-loading]").forEach(a=>{a.style.display=e?"":"none";});}renderNewExperts(t,e){let i=this.querySelector(t,`[${u}${d.template}]`);if(!i){this.log("No template found for rendering new experts",t);return}let a=document.createDocumentFragment();e.forEach(n=>{let o=this.populateExpertCard(i,n);a.appendChild(o);}),t.appendChild(a),this.log(`Rendered ${e.length} new expert cards for load more`);}getAttr(t,e){return t.getAttribute(`${u}${e}`)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return Array.from(t.querySelectorAll(e))}findExpertContainers(){this.log("Looking for expert containers..."),this.log("Document ready state:",document.readyState),this.log("Total elements in document:",document.querySelectorAll("*").length);let t=["[data-contra-limit]","[data-contra-pagination-mode]","[data-contra-template]"],e=[];for(let n of t){let o=Array.from(document.querySelectorAll(n));this.log(`Found ${o.length} elements with selector: ${n}`,o),e.push(...o);}if(e.length===0){this.log("No elements found with standard selectors, trying broader search...");let n=Array.from(document.querySelectorAll("[data-contra-limit], [data-contra-template], [data-contra-pagination-mode]"));this.log(`Found ${n.length} elements with any contra attributes:`,n);let o=Array.from(document.querySelectorAll("div")).filter(s=>{let r=s.hasAttribute("data-contra-limit"),l=s.querySelector("[data-contra-template]"),c=s.className.includes("contra");return r||l||c});this.log(`Found ${o.length} potential container candidates:`,o),e.push(...o);}let i=new Set;for(let n of e)if(n.hasAttribute("data-contra-limit")||n.hasAttribute("data-contra-pagination-mode"))i.add(n),this.log("Found container (has limit/pagination):",n);else if(n.hasAttribute("data-contra-template")){let o=n.parentElement;o&&(i.add(o),this.log("Found container (template parent):",o));}else n.className.includes("contra")&&n.querySelector("[data-contra-template]")&&(i.add(n),this.log("Found container (has contra class and template):",n));let a=Array.from(i);return this.log(`Total unique containers found: ${a.length}`,a),a.length===0&&(this.log("\u274C No containers found! Debugging info:"),this.log("- Document body HTML:",document.body?.innerHTML?.substring(0,500)+"..."),this.log("- All divs:",Array.from(document.querySelectorAll("div")).slice(0,10)),this.log("- Elements with data attributes:",Array.from(document.querySelectorAll("[data-contra-limit], [data-contra-template], [data-contra-pagination-mode]")))),a}parseFiltersFromElement(t){let e={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([a,n])=>{let o=this.getAttr(t,a);o!=null&&(n==="available"?e[n]=o==="true":n==="languages"?e[n]=o.split(",").map(s=>s.trim()):["minRate","maxRate","limit","offset"].includes(n)?e[n]=parseInt(o):e[n]=o);}),e.offset===void 0&&(e.offset=0),e}getControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case "checkbox":return t.checked;case "number":case "range":return t.valueAsNumber;default:return t.value}else if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;return null}updateFilter(t,e,i,a="replace"){let o={...this.state.getState(t).filters},s=i;if(e==="available"?typeof i=="string"&&(i==="true"?s=true:i==="false"?s=false:(i===""||i===null)&&(s=void 0)):(e==="minRate"||e==="maxRate")&&(i===""||i===null?s=void 0:s=Number(i)),a==="append"&&Array.isArray(o[e])){let l=o[e];o[e]=[...l,s];}else o[e]=s;e!=="offset"&&(o.offset=0),this.state.updateState(t,{filters:o}),this.log(`Filter updated: ${e} = ${s} (original: ${i})`);let r={filters:o,element:document.querySelector(`[data-program-id="${t}"]`)};this.dispatchEvent(document,"filterChange",r);}showLoading(t,e){let i=this.querySelector(t,`[${u}${d.loading}]`);i&&(i.style.display=e?"":"none"),t.classList.toggle(this.config.loadingClass,e);}showError(t,e){let i=this.querySelector(t,`[${u}${d.error}]`);i&&(i.textContent=e.message,i.style.display=""),t.classList.add(this.config.errorClass),this.log("Error displayed",e);}dispatchEvent(t,e,i){let a=new CustomEvent(`contra:${e}`,{detail:i});t.dispatchEvent(a);}log(t,...e){this.config.debug&&console.log(`[ContraWebflow] ${t}`,...e);}};function m(){let f=document.getElementById("contra-config");if(!f){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let t=JSON.parse(f.textContent||"{}");if(!t.apiKey){console.error("[ContraWebflow] API key is required in config.");return}if(!t.program){console.error("[ContraWebflow] Program ID is required in config.");return}setTimeout(()=>{let i=new h(t);window.contraRuntime=i,i.init().catch(a=>{console.error("[ContraWebflow] Runtime initialization failed:",a);});},100);}catch(t){console.error("[ContraWebflow] Failed to parse config:",t);}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):document.readyState==="interactive"?setTimeout(m,50):m();export{h as ContraWebflowRuntime};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map
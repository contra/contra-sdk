var u=class u{constructor(e){this.cache=new Map;this.pendingRequests=new Map;this.config={baseUrl:"https://contra.com",timeout:1e4,debug:false,...e},this.config.debug&&console.log("[ContraClient] Initialized with config:",this.config);}async fetch(e,t={},s=3){let i=`${this.config.baseUrl}${e}`,r=new AbortController,a=setTimeout(()=>r.abort(),this.config.timeout),c={...t,signal:r.signal,headers:{Accept:"application/json","X-API-key":this.config.apiKey,...t.headers}};try{this.config.debug&&console.log(`[ContraClient] Fetching: ${i}`,c);let n=await fetch(i,c);if(clearTimeout(a),!n.ok){let l;try{l=await n.json();}catch{l={code:`HTTP_${n.status}`,message:n.statusText||"Unknown error"};}if((n.status>=500||n.status===429)&&s>0){let p=Math.pow(2,3-s)*1e3;return await new Promise(m=>setTimeout(m,p)),this.fetch(e,t,s-1)}throw new h(l.message,l.code,n.status)}let g=await n.json();return this.config.debug&&console.log("[ContraClient] Response:",g),g}catch(n){if(clearTimeout(a),n instanceof h)throw n;if(n instanceof Error&&n.name==="AbortError")throw new h(`Request timeout after ${this.config.timeout}ms`,"TIMEOUT");if(s>0){let g=Math.pow(2,3-s)*1e3;return await new Promise(l=>setTimeout(l,g)),this.fetch(e,t,s-1)}throw new h(n instanceof Error?n.message:"Unknown error","NETWORK_ERROR")}}async fetchWithCache(e,t,s,i){let r=this.cache.get(e);if(r&&Date.now()-r.timestamp<r.ttl)return this.config.debug&&console.log(`[ContraClient] Cache hit: ${e}`),r.data;let a=`${t}${JSON.stringify(i)}`;if(this.pendingRequests.has(a))return this.config.debug&&console.log(`[ContraClient] Request deduplication: ${a}`),this.pendingRequests.get(a);let c=this.fetch(t,i);this.pendingRequests.set(a,c);try{let n=await c;return this.cache.set(e,{data:n,timestamp:Date.now(),ttl:s}),n}finally{this.pendingRequests.delete(a);}}buildQueryString(e){let t=new URLSearchParams;Object.entries(e).forEach(([i,r])=>{r!=null&&r!==""&&(Array.isArray(r)?t.set(i,r.join(",")):t.set(i,String(r)));});let s=t.toString();return s?`?${s}`:""}async getProgram(e){let t=`program:${e}`,s=`/public-api/programs/${e}`;return (await this.fetchWithCache(t,s,u.CACHE_TTL.program)).data}async listExperts(e,t={}){let s=this.buildQueryString(t),i=`experts:${e}:${JSON.stringify(t)}`,r=`/public-api/programs/${e}/experts${s}`;return this.fetchWithCache(i,r,u.CACHE_TTL.experts)}async searchExperts(e,t,s={}){let i=await this.listExperts(e,s);if(t.trim()){let r=t.toLowerCase();i.data=i.data.filter(a=>a.name.toLowerCase().includes(r)||a.oneLiner.toLowerCase().includes(r)||a.skillTags.some(c=>c.toLowerCase().includes(r)));}return i}async getFilterOptions(e){let t=`filters:${e}`,s=`/public-api/programs/${e}/filters`;return this.fetchWithCache(t,s,u.CACHE_TTL.filters)}clearCache(e){if(e)for(let t of this.cache.keys())t.includes(e)&&this.cache.delete(t);else this.cache.clear();this.config.debug&&console.log(`[ContraClient] Cache cleared${e?` (pattern: ${e})`:""}`);}getCacheStats(){let e=Date.now(),t=Array.from(this.cache.entries()).map(([s,i])=>({key:s,age:e-i.timestamp,ttl:i.ttl}));return {size:this.cache.size,entries:t}}};u.CACHE_TTL={experts:5*60*1e3,expert:10*60*1e3,program:30*60*1e3,filters:60*60*1e3};var f=u,h=class extends Error{constructor(t,s,i){super(t);this.code=s;this.status=i;this.name="ContraAPIError";}},d={formatRate(o){return o?`$${o}/hr`:"Rate on request"},renderStars(o){let e=Math.floor(o),t=o%1>=.5,s=5-e-(t?1:0),i="";for(let r=0;r<e;r++)i+=`<svg class="star star-full" width="16" height="16" viewBox="0 0 24 24" fill="#FFD700">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;t&&(i+=`<svg class="star star-half" width="16" height="16" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-${o}">
            <stop offset="50%" stop-color="#FFD700"/>
            <stop offset="50%" stop-color="#E5E5E5"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-${o})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`);for(let r=0;r<s;r++)i+=`<svg class="star star-empty" width="16" height="16" viewBox="0 0 24 24" fill="#E5E5E5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;return i},debounce(o,e){let t;return (...s)=>{clearTimeout(t),t=setTimeout(()=>o(...s),e);}},throttle(o,e){let t;return (...s)=>{t||(o(...s),t=true,setTimeout(()=>t=false,e));}}};export{h as ContraAPIError,f as ContraClient,d as utils};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map
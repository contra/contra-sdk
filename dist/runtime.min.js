"use strict";var ContraWebflow=(()=>{var C=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var P=(p,t)=>{for(var e in t)C(p,e,{get:t[e],enumerable:!0})},F=(p,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of M(t))!R.call(p,s)&&s!==e&&C(p,s,{get:()=>t[s],enumerable:!(i=x(t,s))||i.enumerable});return p};var H=p=>F(C({},"__esModule",{value:!0}),p);var q={};P(q,{ContraWebflowRuntime:()=>v,default:()=>v});var y=class y{constructor(t){this.cache=new Map;this.pendingRequests=new Map;this.config={baseUrl:"https://contra.com",timeout:1e4,debug:!1,...t},this.config.debug&&console.log("[ContraClient] Initialized with config:",this.config)}async fetch(t,e={},i=3){let s=`${this.config.baseUrl}${t}`,r=new AbortController,n=setTimeout(()=>r.abort(),this.config.timeout),o={...e,signal:r.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:this.config.apiKey,"X-API-Key":this.config.apiKey,...e.headers}};try{this.config.debug&&console.log(`[ContraClient] Fetching: ${s}`,o);let a=await fetch(s,o);if(clearTimeout(n),!a.ok){let d;try{d=await a.json()}catch{d={code:`HTTP_${a.status}`,message:a.statusText||"Unknown error"}}if((a.status>=500||a.status===429)&&i>0){let g=Math.pow(2,3-i)*1e3;return await new Promise(u=>setTimeout(u,g)),this.fetch(t,e,i-1)}throw new m(d.message,d.code,a.status)}let l=await a.json();return this.config.debug&&console.log("[ContraClient] Response:",l),l}catch(a){if(clearTimeout(n),a instanceof m)throw a;if(a instanceof Error&&a.name==="AbortError")throw new m(`Request timeout after ${this.config.timeout}ms`,"TIMEOUT");if(i>0){let l=Math.pow(2,3-i)*1e3;return await new Promise(d=>setTimeout(d,l)),this.fetch(t,e,i-1)}throw new m(a instanceof Error?a.message:"Unknown error","NETWORK_ERROR")}}async fetchWithCache(t,e,i,s){let r=this.cache.get(t);if(r&&Date.now()-r.timestamp<r.ttl)return this.config.debug&&console.log(`[ContraClient] Cache hit: ${t}`),r.data;let n=`${e}${JSON.stringify(s)}`;if(this.pendingRequests.has(n))return this.config.debug&&console.log(`[ContraClient] Request deduplication: ${n}`),this.pendingRequests.get(n);let o=this.fetch(e,s);this.pendingRequests.set(n,o);try{let a=await o;return this.cache.set(t,{data:a,timestamp:Date.now(),ttl:i}),a}finally{this.pendingRequests.delete(n)}}buildQueryString(t){let e=new URLSearchParams;Object.entries(t).forEach(([s,r])=>{r!=null&&r!==""&&(Array.isArray(r)?e.set(s,r.join(",")):e.set(s,String(r)))});let i=e.toString();return i?`?${i}`:""}async getProgram(t){let e=`program:${t}`,i=`/public-api/programs/${t}`;return(await this.fetchWithCache(e,i,y.CACHE_TTL.program)).data}async listExperts(t,e={}){let i=this.buildQueryString(e),s=`experts:${t}:${JSON.stringify(e)}`,r=`/public-api/programs/${t}/experts${i}`;return this.fetchWithCache(s,r,y.CACHE_TTL.experts)}async searchExperts(t,e,i={}){let s=await this.listExperts(t,i);if(e.trim()){let r=e.toLowerCase();s.data=s.data.filter(n=>n.name&&n.name.toLowerCase().includes(r)||n.oneLiner&&n.oneLiner.toLowerCase().includes(r)||n.skillTags&&n.skillTags.some(o=>o&&o.toLowerCase().includes(r)))}return s}async getFilterOptions(t){let e=`filters:${t}`,i=`/public-api/programs/${t}/filters`;return this.fetchWithCache(e,i,y.CACHE_TTL.filters)}clearCache(t){if(t)for(let e of this.cache.keys())e.includes(t)&&this.cache.delete(e);else this.cache.clear();this.config.debug&&console.log(`[ContraClient] Cache cleared${t?` (pattern: ${t})`:""}`)}getCacheStats(){let t=Date.now(),e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,age:t-s.timestamp,ttl:s.ttl}));return{size:this.cache.size,entries:e}}};y.CACHE_TTL={experts:5*60*1e3,expert:10*60*1e3,program:30*60*1e3,filters:60*60*1e3};var b=y,m=class extends Error{constructor(e,i,s){super(e);this.code=i;this.status=s;this.name="ContraAPIError"}},S={formatRate(p){return p?`$${p}/hr`:"Rate on request"},renderStars(p){let t=Math.floor(p),e=p%1>=.5,i=5-t-(e?1:0),s="";for(let r=0;r<t;r++)s+=`<svg class="star star-full" width="16" height="16" viewBox="0 0 24 24" fill="#FFD700">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;e&&(s+=`<svg class="star star-half" width="16" height="16" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-${p}">
            <stop offset="50%" stop-color="#FFD700"/>
            <stop offset="50%" stop-color="#E5E5E5"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-${p})" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`);for(let r=0;r<i;r++)s+=`<svg class="star star-empty" width="16" height="16" viewBox="0 0 24 24" fill="#E5E5E5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>`;return s},debounce(p,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>p(...i),t)}},throttle(p,t){let e;return(...i)=>{e||(p(...i),e=!0,setTimeout(()=>e=!1,t))}}};var A=["w_","h_","c_","f_","q_","fl_","vc_","b_","e_","o_","a_","dpr_","ar_"],f="data-contra-",c={listId:"list-id",program:"program",template:"template",loading:"loading",error:"error",empty:"empty",field:"field",format:"format",repeat:"repeat",max:"max",limit:"limit",action:"action",listTarget:"list-target",showWhen:"show-when",hideWhen:"hide-when",prerenderPlaceholders:"prerender-placeholders"},T=class{constructor(){this.states=new Map}getState(t){return this.states.has(t)||this.states.set(t,{filters:{},experts:[],loading:!1,error:null,offset:0,limit:20,totalCount:0,hasNextPage:!1}),this.states.get(t)}updateState(t,e){let i=this.getState(t);Object.assign(i,e),this.states.set(t,i)}},v=class{constructor(t){this.state=new T;this.debouncedReload=new Map;this.filterNameMap={locations:"location"};this.filterOptionLabels={sortBy:{relevance:"Relevance",oldest:"Oldest",newest:"Newest",rate_asc:"Rate (Low to High)",rate_desc:"Rate (High to Low)"}};this.config={debug:!1,loadingClass:"loading",errorClass:"error",emptyClass:"empty",videoAutoplay:!1,videoHoverPlay:!0,videoMuted:!0,videoLoop:!0,videoControls:!1,imageTransformations:"f_auto,q_auto:eco,c_limit,w_800",videoTransformations:"fl_progressive,f_auto,q_auto:eco,vc_auto,c_limit,h_720",optimizeGifsAsVideo:!0,contraAnalytics:!0,...t},this.client=new b({apiKey:this.config.apiKey,debug:this.config.debug}),this.log("Runtime initialized",this.config)}async init(){this.log("Initializing runtime...");try{let t=this.querySelectorAll(document.body,`[${f}${c.listId}]`);this.log(`Found ${t.length} lists to initialize.`);let e=new Map;for(let i of t){let s=this.getAttr(i,c.program);s&&!e.has(s)&&(this.log(`Fetching filters for program: ${s}`),e.set(s,await this.getAvailableFilters(s)))}this.populateAllFilterControls(e);for(let i of t)await this.initList(i);this.wireActionButtons(),this.wireFilterControls(),this.log("Runtime initialization complete")}catch(t){throw this.log("Runtime initialization failed",t),t}}async initList(t){let e=this.getAttr(t,c.listId),i=this.getAttr(t,c.program);if(!e||!i){this.log("List element is missing required attributes `data-contra-list-id` or `data-contra-program`.",t);return}this.log(`Initializing list: ${e} for program: ${i}`);try{t.setAttribute("data-contra-initialized","true"),t.classList.add("contra-list");let s=parseInt(this.getAttr(t,c.limit)||"20",10),r=this.querySelector(t,`[${f}${c.template}]`);if(r&&t.hasAttribute(`${f}${c.prerenderPlaceholders}`)){this.log(`Prerendering ${s} placeholders for list: ${e}`);for(let u=0;u<s;u++){let h=r.cloneNode(!0);h.removeAttribute(`${f}${c.template}`),h.classList.add("contra-placeholder-item"),h.style.display="",t.appendChild(h)}}r&&(r.style.display="none",this.log(`Template found and hidden for list: ${e}`));let n=this.querySelector(t,`[${f}${c.loading}]`);n&&n.style.removeProperty("display");let o=this.querySelector(t,`[${f}${c.empty}]`);o&&o.style.removeProperty("display");let a=this.parseFiltersFromElement(t);this.state.updateState(e,{filters:a,limit:s,offset:a.offset||0}),this.state.updateState(e,{loading:!0,error:null}),this.showLoading(t,!0);let l=await this.client.listExperts(i,a);this.log(`Loaded ${l.data.length} experts for list ${e}`,l);let d=l.data,g=d;this.state.updateState(e,{experts:g,totalCount:l.totalCount,offset:a.offset||0+d.length,hasNextPage:d.length===s,loading:!1}),this.renderExperts(t,d,!1),this.updateUIStates(t,e)}catch(s){this.log(`Failed to initialize list ${e}`,s),this.state.updateState(e,{loading:!1,error:s}),this.showError(t,s)}finally{this.showLoading(t,!1)}}wireActionButtons(){this.querySelectorAll(document.body,`[${f}${c.action}]`).forEach(e=>{let i=this.getAttr(e,c.action),s=this.getAttr(e,c.listTarget);if(!i||!s){this.log("Action button is missing required `data-contra-action` or `data-contra-list-target` attributes.",e);return}e.addEventListener("click",r=>{r.preventDefault(),this.handleAction(i,s,e)})})}async loadExperts(t,e,i=!1){let s=this.querySelector(document.body,`[${f}${c.listId}="${t}"]`);if(!s){this.log(`Cannot find list element with ID: ${t}`);return}let r=this.querySelector(s,`[${f}${c.empty}]`);!i&&r&&(r.style.display="none");let n=this.state.getState(t),o={...n.filters,limit:n.limit,offset:n.offset};this.log(`Loading experts for list: ${t}`,o);try{this.showLoading(s,!0),this.state.updateState(t,{loading:!0,error:null});let a=await this.client.listExperts(e,o);this.log(`Loaded ${a.data.length} experts for list ${t}`,a);let l=a.data,d=i?[...n.experts,...l]:l;this.state.updateState(t,{experts:d,totalCount:a.totalCount,offset:n.offset+l.length,hasNextPage:l.length===n.limit,loading:!1}),this.renderExperts(s,l,i),this.updateUIStates(s,t)}catch(a){this.log(`Failed to load experts for list: ${t}`,a),this.state.updateState(t,{loading:!1,error:a}),this.showError(s,a)}finally{this.showLoading(s,!1)}}renderExperts(t,e,i){let s=this.querySelector(t,`[${f}${c.template}]`);if(!s){this.log("No template found in list",t);return}let r=this.getAttr(t,c.listId),n=this.querySelectorAll(t,".contra-placeholder-item");if(!i&&n.length>0){if(this.log(`Populating ${e.length} of ${n.length} placeholders for list.`),e.forEach((a,l)=>{let d=n[l];d&&(this._configureCard(d,a,r),d.classList.remove("contra-placeholder-item"))}),e.length<n.length){this.log(`Removing ${n.length-e.length} unused placeholders.`);for(let a=e.length;a<n.length;a++)n[a].remove()}this.log("Finished rendering placeholders for list",t);return}i||this.querySelectorAll(t,".contra-rendered-item").forEach(l=>l.remove());let o=document.createDocumentFragment();e.forEach(a=>{let l=this.populateExpertCard(s,a,r);o.appendChild(l)}),t.appendChild(o),this.log(`Rendered ${e.length} expert cards into list`,t)}populateExpertCard(t,e,i){let s=t.cloneNode(!0);return this._configureCard(s,e,i),s}_configureCard(t,e,i){t.classList.add("contra-rendered-item"),t.removeAttribute(`${f}${c.template}`),t.style.display="";let s=this.querySelectorAll(t,`[${f}${c.repeat}]`),r=new Map;s.forEach(n=>{let o=document.createDocumentFragment();for(;n.firstChild;)o.appendChild(n.firstChild);r.set(n,o)}),this.populateFields(t,e,i),r.forEach((n,o)=>{o.appendChild(n)}),this.populateRepeatingElements(t,e,i),this.handleConditionalDisplay(t,e)}populateFields(t,e,i){this.querySelectorAll(t,`[${f}${c.field}]`).forEach(n=>{let o=this.getAttr(n,c.field),a=this.getAttr(n,c.format);if(!o||!(o in e))return;let l=e[o];this.setElementValue(n,l,a,i)}),this.querySelectorAll(t,"[data-contra-stars]").forEach(n=>{e.averageReviewScore&&this.renderStarRating(n,e.averageReviewScore)})}setElementValue(t,e,i,s){if(!(e==null||e==="")){if(this.isMediaField(t)&&typeof e=="string"&&e.trim()){this.setMediaValue(t,e);return}if(t instanceof HTMLAnchorElement){let r=String(e);s&&(r=this._appendContraAnalytics(r,s)),t.href=r,t.children.length===0&&!t.textContent?.trim()&&(t.textContent=String(e))}else if(t instanceof HTMLInputElement)t.value=String(e);else if(t instanceof HTMLImageElement){let r=this.detectMediaType(String(e)),n=this.transformMediaUrl(String(e),r);t.src=n,t.alt=t.alt||"Image"}else{let r=String(e);if(i)switch(i){case"currency":r=typeof e=="number"?`$${e}`:r;break;case"rate":r=S.formatRate(typeof e=="number"?e:null);break;case"rating":r=typeof e=="number"?e.toFixed(1):r;break;case"earnings":typeof e=="number"&&(e>=1e6?r=`$${Math.floor(e/1e6)}M+`:e>=1e3?r=`$${Math.floor(e/1e3)}k+`:r=`$${e}`);break;case"number":r=typeof e=="number"?e.toLocaleString():r;break;case"truncate":r=r.length>100?r.substring(0,97)+"...":r;break;case"boolean":r=e?"Yes":"No";break;case"availability":r=e?"Available":"Not Available";break}t.textContent=r}}}renderStarRating(t,e){let i=Math.floor(e),s=e%1>=.5,r=5-i-(s?1:0),n="";for(let a=0;a<i;a++)n+='<span class="contra-star contra-star-full">\u2605</span>';s&&(n+='<span class="contra-star contra-star-half">\u2605</span>');for(let a=0;a<r;a++)n+='<span class="contra-star contra-star-empty">\u2606</span>';t.innerHTML=n;let o=t.closest("[data-contra-template]")||t.closest(".expert-card");o&&this.querySelectorAll(o,"[data-contra-rating-text]").forEach(l=>{l.textContent=e.toFixed(1)})}isMediaField(t){return this.getAttr(t,c.field)==="coverUrl"}setMediaValue(t,e){let i=this.detectMediaType(e),s=t.parentElement;if(!s){this.log("Media element has no parent for replacement",t);return}t.remove();let r;switch(i){case"video":let n=this.transformMediaUrl(e,"video");r=this.createVideoElement(n,t);break;case"image":default:let o=this.transformMediaUrl(e,"image");r=this.createImageElement(o,t);break}this.transferAttributes(t,r),s.appendChild(r),this.log(`Created ${i} element for URL: ${e}`)}detectMediaType(t){if(!t||typeof t!="string")return this.log("Invalid URL provided to detectMediaType:",t),"image";let e=t.toLowerCase();if(this.config.optimizeGifsAsVideo&&e.endsWith(".gif"))return"video";let s=[".mp4",".webm",".mov",".avi",".mkv",".ogg"].some(n=>e.endsWith(n)),r=e.includes("cloudinary.com/")&&e.includes("/video/");return s||r?"video":"image"}createVideoElement(t,e){let i=document.createElement("video");i.src=t,i.loop=this.config.videoLoop,i.playsInline=!0,i.preload="metadata",i.controls=this.config.videoControls;let s=this.extractVideoThumbnail(t);if(s&&(i.poster=s,this.log(`Set poster for video ${t}: ${s}`)),this.config.videoMuted&&(i.muted=!0,i.setAttribute("muted","")),i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",this.config.videoAutoplay){i.autoplay=!0,i.setAttribute("autoplay","");let r=i.play();r!==void 0&&r.catch(n=>{this.log("Autoplay was prevented.",{error:n,videoUrl:t})})}return i.onerror=()=>{this.log(`Video failed to load: ${t}`);let r=this.createImageElement(s||t,e);i.parentElement&&i.parentElement.replaceChild(r,i)},this.config.videoHoverPlay&&!this.config.videoAutoplay&&(i.addEventListener("mouseenter",()=>{i.currentTime=0,i.play().catch(()=>{})}),i.addEventListener("mouseleave",()=>{i.pause(),i.currentTime=0}),i.addEventListener("click",r=>{r.preventDefault(),i.paused?(i.currentTime=0,i.play().catch(n=>this.log("Video play failed on click",n))):i.pause()})),i}createImageElement(t,e){let i=document.createElement("img");return i.src=t,i.alt=e.getAttribute("alt")||"Media content",i.loading="lazy",i.style.width="100%",i.style.height="100%",i.style.objectFit="cover",i.style.borderRadius="inherit",i.onerror=()=>{this.log(`Image failed to load: ${t}`),i.style.background="#f3f4f6",i.style.opacity="0.5",i.alt="Image unavailable",i.style.position="relative";let s=document.createElement("div");s.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #9ca3af;
        font-size: 12px;
        text-align: center;
      `,s.textContent="\u{1F5BC}\uFE0F Image unavailable",i.parentElement?.appendChild(s)},i}extractVideoThumbnail(t){if(!t.includes("/upload/"))return this.log("URL does not appear to be a Cloudinary video, cannot generate poster.",t),null;let e=t.replace(/\.(mp4|webm|mov|avi|mkv|ogg|gif)$/i,".jpg"),i="/upload/",s=e.split(i);if(s.length!==2)return this.log(`Could not parse URL for thumbnail generation: ${t}`),e;let[r,n]=s,o=n.split("/"),a=o[0];if(!A.some(E=>a.includes(E)))return this.log(`No Cloudinary transformations found, returning basic .jpg poster URL for: ${t}`),e;let h=(o.shift()||"").split(",").filter(E=>!E.startsWith("fl_")&&E!=="f_auto").join(",");h&&o.unshift(h);let $=o.join("/"),w=`${r}${i}${$}`;return this.log(`Generated poster URL: ${w} from video URL: ${t}`),w}transferAttributes(t,e){if(t.className&&(e.className=t.className),Array.from(t.attributes).forEach(i=>{i.name.startsWith("data-")&&i.name!==`${f}${c.field}`&&e.setAttribute(i.name,i.value)}),t.getAttribute("style")){let i=e.getAttribute("style")||"";e.setAttribute("style",i+"; "+t.getAttribute("style"))}}populateRepeatingElements(t,e,i){this.querySelectorAll(t,`[${f}${c.repeat}]`).forEach(r=>{let n=this.getAttr(r,c.repeat),o=parseInt(this.getAttr(r,c.max)||"10");n==="projects"&&e.projects?this.populateRepeatingContainer(r,e.projects.slice(0,o),i):n==="socialLinks"&&e.socialLinks?this.populateRepeatingContainer(r,e.socialLinks.slice(0,o),i):n==="skillTags"&&e.skillTags&&this.populateRepeatingContainer(r,e.skillTags.slice(0,o).map(a=>({name:a})),i)})}populateRepeatingContainer(t,e,i){let s=t.firstElementChild;s&&(t.innerHTML="",e.forEach(r=>{let n=s.cloneNode(!0);this.populateFields(n,r,i),t.appendChild(n)}),e.length===0&&(t.style.display="none"))}handleConditionalDisplay(t,e){this.querySelectorAll(t,`[${f}${c.showWhen}], [${f}${c.hideWhen}]`).forEach(s=>{let r=this.getAttr(s,c.showWhen),n=this.getAttr(s,c.hideWhen),o=!0;r&&(o=this.evaluateCondition(e,r)),n&&(o=o&&!this.evaluateCondition(e,n)),s.style.display=o?"":"none"})}evaluateCondition(t,e){if(!e||typeof e!="string")return this.log("Invalid condition provided:",e),!1;let i=e.split(":");if(i.length<2)return this.log("Invalid condition format:",e),!1;let s=i[0],r=i.slice(1).join(":"),n=t[s];if(this.log(`Evaluating condition: ${s} (${n}, type: ${typeof n}) against ${r}`),n==null)return this.log(`Field '${s}' is null/undefined, condition fails`),!1;if(r.startsWith(">=")){let o=r.substring(2),a=Number(n)>=Number(o);return this.log(`Comparison: ${n} >= ${o} = ${a}`),a}else if(r.startsWith("<=")){let o=r.substring(2),a=Number(n)<=Number(o);return this.log(`Comparison: ${n} <= ${o} = ${a}`),a}else if(r.startsWith(">")){let o=r.substring(1),a=Number(n)>Number(o);return this.log(`Comparison: ${n} > ${o} = ${a}`),a}else if(r.startsWith("<")){let o=r.substring(1),a=Number(n)<Number(o);return this.log(`Comparison: ${n} < ${o} = ${a}`),a}else{let o=!1;if(typeof n=="boolean")r.toLowerCase()==="true"?o=n===!0:r.toLowerCase()==="false"?o=n===!1:o=!1,this.log(`Boolean comparison: ${n} === ${r.toLowerCase()==="true"} = ${o}`);else if(typeof n=="number"){let a=Number(r);o=!isNaN(a)&&n===a,this.log(`Number comparison: ${n} === ${a} = ${o}`)}else{let a=String(n),l=String(r);o=a.toLowerCase()===l.toLowerCase(),this.log(`String comparison: '${a}' === '${l}' = ${o}`)}return o}}updateUIStates(t,e){let i=this.state.getState(e),s=this.querySelector(t,`[${f}${c.empty}]`);if(s){let o=!i.loading&&i.experts.length===0?"block":"none";s.style.setProperty("display",o,"important"),this.log(`List ${e}: Empty state display set to '${o}'.`)}let r=this.querySelector(document.body,`[${f}${c.action}="load-more"][${f}${c.listTarget}="${e}"]`);if(r){let n=r,a=!i.loading&&i.hasNextPage?"inline-block":"none";r.style.setProperty("display",a,"important"),n.disabled=i.loading,n.textContent=i.loading?"Loading...":"Load More"}}handleAction(t,e,i){if(t==="load-more"){let s=this.querySelector(document.body,`[${f}${c.listId}="${e}"]`),r=this.getAttr(s,c.program);s&&r?this.loadExperts(e,r,!0):this.log(`Could not find list or program for target: ${e}`)}else t==="clear-filters"&&this.clearFilters(e)}clearFilters(t){let e=this.querySelector(document.body,`[${f}${c.listId}="${t}"]`);if(!e){this.log(`Cannot find list element with ID: ${t} to clear filters.`);return}let i=this.getAttr(e,c.program);if(!i){this.log(`Cannot find programId for list: ${t}`);return}this.log(`Clearing filters for list: ${t}`),this.state.updateState(t,{filters:{},offset:0}),this.querySelectorAll(document.body,`[data-contra-filter][data-contra-list-target="${t}"]`).forEach(r=>{this.resetControlValue(r)}),this.loadExperts(t,i,!1)}resetControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":case"radio":t.checked=!1;break;case"number":case"range":t.value="";break;default:t.value="";break}else t instanceof HTMLSelectElement&&(t.selectedIndex=0)}updateFilterAndReload(t,e,i,s){let n={...this.state.getState(t).filters},o=s;if(i==="available"?o=s?!0:void 0:["minRate","maxRate"].includes(i)?o=s===""||s===null?void 0:Number(s):i==="languages"&&typeof s=="string"&&(o=s.split(",").map(a=>a.trim()).filter(a=>a),o.length===0&&(o=void 0)),o!==void 0&&o!==""){let a=this.filterNameMap[i]||i;n[a]=o}else{let a=this.filterNameMap[i]||i;delete n[a]}this.state.updateState(t,{filters:n,offset:0}),this.log(`Filter updated for list ${t}, reloading. New filters:`,n),this.loadExperts(t,e,!1)}wireFilterControls(){let t=this.querySelectorAll(document.body,"[data-contra-filter]");this.log(`Found ${t.length} filter controls to wire.`),t.forEach(e=>{let i=e.getAttribute("data-contra-filter"),s=e.getAttribute("data-contra-list-target");if(!i||!s){this.log("Filter control missing required attributes: data-contra-filter or data-contra-list-target",e);return}let r=this.querySelector(document.body,`[${f}list-id="${s}"]`);if(!r)return;let n=this.getAttr(r,c.program);if(!n)return;let o=e instanceof HTMLInputElement&&["text","search"].includes(e.type)?300:0,a=()=>{let g=this.getControlValue(e);this.updateFilterAndReload(s,n,i,g)},l=this.debounce(a,o),d=e instanceof HTMLInputElement&&["text","search"].includes(e.type)?"input":"change";e.addEventListener(d,l)})}debounce(t,e){let i;return(...s)=>{clearTimeout(i),e>0?i=window.setTimeout(()=>t.apply(this,s),e):t.apply(this,s)}}getAttr(t,e){return t.getAttribute(`${f}${e}`)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return Array.from(t.querySelectorAll(e))}parseFiltersFromElement(t){let e={};return Object.entries({available:"available",languages:"languages",location:"location","min-rate":"minRate","max-rate":"maxRate",sort:"sortBy",limit:"limit",offset:"offset"}).forEach(([s,r])=>{let n=this.getAttr(t,s);n!=null&&(r==="available"?e[r]=n==="true":r==="languages"?e[r]=n.split(",").map(o=>o.trim()):["minRate","maxRate","limit","offset"].includes(r)?e[r]=parseInt(n):e[r]=n)}),e.offset===void 0&&(e.offset=0),e}getControlValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":return t.checked;case"number":case"range":return t.valueAsNumber;default:return t.value}else if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;return null}showLoading(t,e){let i=this.querySelector(t,`[${f}${c.loading}]`);if(i){let s=e?"block":"none";i.style.setProperty("display",s,"important")}}showError(t,e){let i=this.querySelector(t,`[${f}${c.error}]`);i&&(i.textContent=e.message,i.style.setProperty("display","block","important")),t.classList.add(this.config.errorClass),this.log("Error displayed",e)}dispatchEvent(t,e,i){let s=new CustomEvent(`contra:${e}`,{detail:i});t.dispatchEvent(s)}log(t,...e){this.config.debug&&console.log(`[ContraWebflow] ${t}`,...e)}async getAvailableFilters(t){let e=`https://contra.com/public-api/programs/${t}/filters`;this.log(`Fetching available filters for program: ${t}`);try{let i=await fetch(e,{headers:{"X-API-Key":this.config.apiKey,Accept:"application/json"}});if(!i.ok)throw new Error(`Failed to fetch filters: ${i.statusText}`);let s=await i.json();return this.log("Successfully fetched filters",s.data),s.data||[]}catch(i){return this.log("Error fetching available filters",i),[]}}getFilterOptionLabel(t,e){let i=this.filterOptionLabels[t];return i&&i[e]?i[e]:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}populateAllFilterControls(t){this.log("Populating all filter controls on the page..."),this.querySelectorAll(document.body,"[data-contra-filter]").forEach(i=>{let s=i.getAttribute("data-contra-list-target");if(!s)return;let r=this.querySelector(document.body,`[data-contra-list-id="${s}"]`);if(!r)return;let n=this.getAttr(r,c.program);if(!n)return;let o=t.get(n);if(!o)return;let a=i.getAttribute("data-contra-filter"),l=o.find(d=>d.name===a);l&&(l.type==="number"&&i instanceof HTMLInputElement&&(l.minimum!==void 0&&(i.min=String(l.minimum)),l.maximum!==void 0&&(i.max=String(l.maximum))),l.options&&(i instanceof HTMLSelectElement?this.populateSelectControl(i,a,l.options):i instanceof HTMLInputElement&&i.getAttribute("list")&&this.populateDatalistControl(i,a,l.options)))})}populateSelectControl(t,e,i){this.log(`Populating options for filter '${e}' on control`,t);let s=t.firstElementChild?.cloneNode(!0);t.innerHTML="",s&&s.getAttribute("value")===""&&t.appendChild(s),i.forEach(r=>{let n=document.createElement("option"),o=typeof r=="object"&&r.value!==void 0?r.value:String(r);n.value=o;let a;if(e==="locations"){let l=o.match(/^(.*?)\s*\(/);a=l?l[1].trim():o}else a=this.getFilterOptionLabel(e,o);n.textContent=a,e==="sortBy"&&o==="relevance"&&(n.selected=!0),t.appendChild(n)})}populateDatalistControl(t,e,i){let s=t.getAttribute("list");if(!s)return;let r=document.getElementById(s);if(!r){this.log(`Datalist with id '${s}' not found for input control.`,t);return}this.log(`Populating datalist '#${s}' for filter '${e}'`),r.innerHTML="",i.forEach(n=>{let o=document.createElement("option"),a=typeof n=="object"&&n.value!==void 0?n.value:String(n),l=a;if(e==="locations"){let d=a.match(/^(.*?)\s*\(/);l=d?d[1].trim():a}o.value=l,r.appendChild(o)})}transformMediaUrl(t,e){if(!t||!t.includes("cloudinary.com/")&&!t.includes("media.contra.com/"))return t;let i=e==="image"?this.config.imageTransformations:this.config.videoTransformations;if(!i)return t;let s=t;e==="video"&&t.toLowerCase().endsWith(".gif")&&(s=t.replace(/\.gif$/i,".mp4"),this.log(`Converting GIF to MP4: ${s}`));let r="/upload/",n=s.split(r);if(n.length!==2)return this.log(`Could not apply transformations, URL format unexpected: ${s}`),s;let[o,a]=n,l=a.split("/"),d=l[0];A.some($=>d.includes($))&&(this.log(`Removing existing transformations from URL: ${s}`),l.shift());let u=l.join("/"),h=`${o}${r}${i}/${u}`;return this.log(`Transformed ${e} URL from "${t}" to "${h}"`),h}_stringifyFilters(t){return Object.entries(t).filter(([,e])=>!(e==null||Array.isArray(e)&&e.length===0||typeof e=="string"&&e.trim()==="")).map(([e,i])=>{let s=Array.isArray(i)?i.join(","):String(i);return`${e}:${s}`}).join("|")}_appendContraAnalytics(t,e){if(!this.config.contraAnalytics||!t)return t;try{let i=document.querySelector(`[${f}${c.listId}="${e}"]`);if(!i)return t;let s=this.getAttr(i,c.program),n=this.state.getState(e).filters,o=new URLSearchParams;o.set("contra_source","webflow_sdk"),s&&o.set("contra_program_id",s),e&&o.set("contra_list_id",e);let a=this._stringifyFilters(n);if(a&&o.set("contra_filters",a),!t.startsWith("http"))return this.log("Cannot append analytics to a relative or invalid URL",{url:t}),t;let l=new URL(t);return o.forEach((d,g)=>{l.searchParams.set(g,d)}),l.toString()}catch(i){return this.log("Failed to append Contra analytics to URL.",{url:t,error:i}),t}}};function L(){let p=document.getElementById("contra-config");if(!p){console.warn("[ContraWebflow] No config element found. Runtime not initialized.");return}try{let t=JSON.parse(p.textContent||"{}");if(!t.apiKey){console.error("[ContraWebflow] API key is required in config.");return}setTimeout(()=>{let i=new v(t);window.contraRuntime=i,i.init().catch(s=>{console.error("[ContraWebflow] Runtime initialization failed:",s)})},100)}catch(t){console.error("[ContraWebflow] Failed to parse config:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):document.readyState==="interactive"?setTimeout(L,50):L();return H(q);})();
//# sourceMappingURL=runtime.min.js.map